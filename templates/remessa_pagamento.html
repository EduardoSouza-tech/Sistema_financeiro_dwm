<!-- 
    Módulo de Remessa de Pagamentos - Sicredi
    HTML Component para Sistema Financeiro
    Versão: 1.0.0 - 09/02/2026
    
    Este component deve ser incluído em interface_nova.html
-->

<div id="remessa-pagamento-section" class="content-card hidden remessa-container">
    
    <!-- HEADER -->
    <div class="remessa-header">
        <div>
            <h1><i class="fas fa-file-invoice-dollar"></i> Remessa de Pagamentos - Sicredi</h1>
            <p style="margin: 8px 0 0 0; color: #7f8c8d;">Geração de arquivos CNAB 240 para pagamentos em lote</p>
        </div>
        <div class="remessa-actions">
            <button class="btn btn-outline" id="btn-historico" onclick="RemessaPagamento.carregarHistorico()">
                <i class="fas fa-history"></i> Histórico
            </button>
            <button class="btn btn-secondary" id="btn-configuracao" onclick="RemessaPagamento.abrirModalConfiguracao()">
                <i class="fas fa-cog"></i> Configuração
            </button>
            <button class="btn btn-success" id="btn-gerar-remessa" onclick="RemessaPagamento.abrirModalGerarRemessa()" disabled>
                <i class="fas fa-file-export"></i> Gerar Remessa
            </button>
        </div>
    </div>

    <!-- ESTATÍSTICAS -->
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-card-header">
                <span class="stat-card-label">Total de Contas</span>
                <i class="fas fa-receipt stat-card-icon"></i>
            </div>
            <div class="stat-card-value" id="stat-total-contas">0</div>
            <div class="stat-card-subtitle">Contas pendentes de pagamento</div>
        </div>

        <div class="stat-card">
            <div class="stat-card-header">
                <span class="stat-card-label">Valor Total</span>
                <i class="fas fa-dollar-sign stat-card-icon"></i>
            </div>
            <div class="stat-card-value" id="stat-total-valor">R$ 0,00</div>
            <div class="stat-card-subtitle">Soma de todas as contas</div>
        </div>

        <div class="stat-card">
            <div class="stat-card-header">
                <span class="stat-card-label">Selecionadas</span>
                <i class="fas fa-check-square stat-card-icon"></i>
            </div>
            <div class="stat-card-value" id="stat-selecionadas">0</div>
            <div class="stat-card-subtitle" id="stat-valor-selecionado">R$ 0,00 selecionados</div>
        </div>

        <div class="stat-card">
            <div class="stat-card-header">
                <span class="stat-card-label">Por Tipo</span>
                <i class="fas fa-chart-pie stat-card-icon"></i>
            </div>
            <div id="stat-por-tipo" style="font-size: 13px;">
                <div class="stat-tipo">
                    <span>Carregando...</span>
                </div>
            </div>
        </div>
    </div>

    <!-- FILTROS -->
    <div class="filtros-panel">
        <div class="filtros-grid">
            <div class="filtro-group">
                <label for="filtro-data-inicio">Data Início</label>
                <input type="date" id="filtro-data-inicio" />
            </div>

            <div class="filtro-group">
                <label for="filtro-data-fim">Data Fim</label>
                <input type="date" id="filtro-data-fim" />
            </div>

            <div class="filtro-group">
                <label for="filtro-tipo-pagamento">Tipo de Pagamento</label>
                <select id="filtro-tipo-pagamento">
                    <option value="TODOS">Todos</option>
                    <option value="TED">TED</option>
                    <option value="PIX">PIX</option>
                    <option value="BOLETO">Boleto</option>
                    <option value="TRIBUTO">Tributo</option>
                    <option value="INDEFINIDO">Indefinido</option>
                </select>
            </div>

            <div class="filtro-group">
                <label for="filtro-vencimento">Status Vencimento</label>
                <select id="filtro-vencimento">
                    <option value="TODOS">Todos</option>
                    <option value="VENCIDO">Vencidos</option>
                    <option value="VENCE_HOJE">Vence Hoje</option>
                    <option value="VENCE_SEMANA">Vence esta Semana</option>
                    <option value="A_VENCER">A Vencer</option>
                </select>
            </div>
        </div>

        <div class="filtros-actions">
            <button class="btn btn-secondary" id="btn-limpar-filtros">
                <i class="fas fa-eraser"></i> Limpar Filtros
            </button>
            <button class="btn btn-primary" onclick="RemessaPagamento.aplicarFiltros()">
                <i class="fas fa-search"></i> Aplicar Filtros
            </button>
        </div>
    </div>

    <!-- TABELA DE CONTAS A PAGAR -->
    <div class="tabela-container">
        <div class="tabela-header">
            <div>
                <h2>Contas a Pagar Pendentes</h2>
                <small style="color: #7f8c8d;">Selecione as contas para incluir na remessa</small>
            </div>
            <div>
                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                    <input type="checkbox" id="selecionar-todos" />
                    <span style="font-size: 14px; font-weight: 600;">Selecionar todos</span>
                </label>
            </div>
        </div>

        <div class="tabela-wrapper">
            <div id="loading-principal" class="loading-spinner">
                <div class="spinner"></div>
                <p>Carregando contas...</p>
            </div>

            <table>
                <thead>
                    <tr>
                        <th style="width: 40px; text-align: center;">
                            <i class="fas fa-check"></i>
                        </th>
                        <th style="width: 120px;">Vencimento</th>
                        <th>Descrição / Fornecedor</th>
                        <th style="width: 130px; text-align: right;">Valor</th>
                        <th style="width: 120px; text-align: center;">Tipo</th>
                        <th style="width: 150px;">Categoria</th>
                        <th style="width: 200px;">Dados Bancários</th>
                        <th style="width: 120px; text-align: center;">Status</th>
                        <th style="width: 60px; text-align: center;">Ações</th>
                    </tr>
                </thead>
                <tbody id="tabela-contas-body">
                    <tr>
                        <td colspan="9" style="text-align: center; padding: 40px; color: #7f8c8d;">
                            <i class="fas fa-inbox" style="font-size: 48px; margin-bottom: 16px; display: block;"></i>
                            Clique em "Aplicar Filtros" para carregar contas pendentes
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- SEÇÃO DE HISTÓRICO (inicialmente oculta) -->
    <div id="historico-secao" class="mt-3" style="display: none;">
        <div class="tabela-container">
            <div class="tabela-header">
                <h2>Histórico de Remessas</h2>
                <button class="btn-icon" onclick="document.getElementById('historico-secao').style.display='none'">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <div style="padding: 20px;">
                <div id="loading-historico" class="loading-spinner">
                    <div class="spinner"></div>
                    <p>Carregando histórico...</p>
                </div>

                <div id="historico-remessas" class="historico-grid">
                    <!-- Cards de remessas serão inseridos aqui -->
                </div>
            </div>
        </div>
    </div>

</div>

<!-- ============================================================================= -->
<!-- MODAL: GERAR REMESSA -->
<!-- ============================================================================= -->

<div id="modal-gerar-remessa" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2><i class="fas fa-file-export"></i> Gerar Remessa de Pagamento</h2>
            <button class="modal-close" onclick="RemessaPagamento.fecharModal('modal-gerar-remessa')">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="modal-body">
            <p style="margin-bottom: 24px; color: #7f8c8d;">
                Você selecionou <strong id="modal-qtd-selecionadas">0</strong> contas para pagamento.
                Informe os dados para gerar o arquivo CNAB 240.
            </p>

            <div class="form-group">
                <label for="modal-data-pagamento">
                    Data de Pagamento <span style="color: #e74c3c;">*</span>
                </label>
                <input type="date" id="modal-data-pagamento" required />
                <small>Data em que os pagamentos serão efetivados pelo banco</small>
            </div>

            <div class="form-group">
                <label for="modal-observacoes">Observações</label>
                <textarea id="modal-observacoes" placeholder="Informações adicionais (opcional)"></textarea>
            </div>

            <div style="background: #fff9c4; padding: 16px; border-radius: 6px; border-left: 4px solid #f57f17;">
                <strong style="display: block; margin-bottom: 8px;">⚠️ Atenção:</strong>
                <ul style="margin: 0; padding-left: 20px; font-size: 13px;">
                    <li>Verifique se todos os dados bancários estão corretos</li>
                    <li>O arquivo CNAB gerado deve ser enviado ao banco</li>
                    <li>As contas serão marcadas como "Incluídas em Remessa"</li>
                    <li>A remessa receberá um número sequencial automático</li>
                </ul>
            </div>

            <div id="loading-modal-gerar" class="loading-spinner">
                <div class="spinner"></div>
                <p>Gerando remessa...</p>
            </div>
        </div>

        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="RemessaPagamento.fecharModal('modal-gerar-remessa')">
                <i class="fas fa-times"></i> Cancelar
            </button>
            <button class="btn btn-success" onclick="RemessaPagamento.gerarRemessa()">
                <i class="fas fa-check"></i> Gerar Remessa
            </button>
        </div>
    </div>
</div>

<!-- ============================================================================= -->
<!-- MODAL: CONFIGURAÇÃO SICREDI -->
<!-- ============================================================================= -->

<div id="modal-configuracao" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2><i class="fas fa-cog"></i> Configuração Sicredi</h2>
            <button class="modal-close" onclick="RemessaPagamento.fecharModal('modal-configuracao')">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="modal-body">
            <p style="margin-bottom: 24px; color: #7f8c8d;">
                Configure os dados do convênio Sicredi para geração de remessas.
                Estes dados são fornecidos pelo banco.
            </p>

            <div class="form-group">
                <label for="config-codigo-beneficiario">
                    Código Beneficiário <span style="color: #e74c3c;">*</span>
                </label>
                <input type="text" id="config-codigo-beneficiario" placeholder="Ex: 12345" required />
                <small>Código fornecido pelo Sicredi para identificação da empresa</small>
            </div>

            <div class="form-group">
                <label for="config-codigo-convenio">
                    Código Convênio <span style="color: #e74c3c;">*</span>
                </label>
                <input type="text" id="config-codigo-convenio" placeholder="Ex: 123456789" required />
                <small>Número do convênio de cobrança/pagamento</small>
            </div>

            <div class="form-group">
                <label for="config-agencia">
                    Agência <span style="color: #e74c3c;">*</span>
                </label>
                <input type="text" id="config-agencia" placeholder="Ex: 0001" maxlength="5" required />
                <small>Agência Sicredi (4 ou 5 dígitos)</small>
            </div>

            <div class="form-group">
                <label for="config-conta">
                    Conta Corrente <span style="color: #e74c3c;">*</span>
                </label>
                <input type="text" id="config-conta" placeholder="Ex: 12345678" required />
                <small>Número da conta sem o dígito verificador</small>
            </div>

            <div class="form-group">
                <label for="config-posto">Posto (Opcional)</label>
                <input type="text" id="config-posto" placeholder="Ex: 01" maxlength="2" />
                <small>Código do posto, se aplicável</small>
            </div>

            <div class="form-group">
                <label for="config-codigo-cedente">Código Cedente (Opcional)</label>
                <input type="text" id="config-codigo-cedente" placeholder="Ex: 12345" maxlength="5" />
                <small>Código cedente, se aplicável</small>
            </div>

            <div style="background: #e0f7fa; padding: 16px; border-radius: 6px; border-left: 4px solid #0097a7;">
                <strong style="display: block; margin-bottom: 8px;">ℹ️ Informações:</strong>
                <ul style="margin: 0; padding-left: 20px; font-size: 13px;">
                    <li>Banco Sicredi: Código 748</li>
                    <li>Layout CNAB 240 versão 103</li>
                    <li>Contate o gerente Sicredi para obter os códigos</li>
                    <li>Mantenha estes dados em sigilo</li>
                </ul>
            </div>

            <div id="loading-modal-config" class="loading-spinner">
                <div class="spinner"></div>
                <p>Salvando configuração...</p>
            </div>
        </div>

        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="RemessaPagamento.fecharModal('modal-configuracao')">
                <i class="fas fa-times"></i> Cancelar
            </button>
            <button class="btn btn-success" onclick="RemessaPagamento.salvarConfiguracao()">
                <i class="fas fa-save"></i> Salvar Configuração
            </button>
        </div>
    </div>
</div>

<!-- ============================================================================= -->
<!-- SCRIPTS -->
<!-- ============================================================================= -->

<script>
// Inicializar módulo quando a seção estiver ativa
document.addEventListener('DOMContentLoaded', function() {
    // Observar quando a seção de remessa for exibida
    const observer = new MutationObserver(function(mutations) {
        mutations.forEach(function(mutation) {
            const secaoRemessa = document.getElementById('secao-remessa');
            if (secaoRemessa && secaoRemessa.style.display !== 'none') {
                if (!window.remessaInicializada) {
                    window.remessaInicializada = true;
                    RemessaPagamento.init();
                    console.log('✅ Módulo Remessa inicializado');
                }
            }
        });
    });

    const config = { attributes: true, childList: true, subtree: true };
    observer.observe(document.body, config);
});
</script>

<!-- ============================================================================= -->
<!-- ESTILOS INLINE (se necessário) -->
<!-- ============================================================================= -->

<style>
/* Estilos adicionais específicos para integração */
#secao-remessa {
    animation: fadeIn 0.3s ease-in;
}

/* Sobrescrever estilos globais se necessário */
#secao-remessa input[type="checkbox"] {
    width: 16px;
    height: 16px;
    cursor: pointer;
}

#secao-remessa input[type="checkbox"]:checked {
    accent-color: #3498db;
}

/* Melhorar visualização em telas pequenas */
@media (max-width: 1200px) {
    .remessa-header {
        padding: 16px;
    }
    
    .remessa-header h1 {
        font-size: 22px;
    }
}
</style>
