<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- CSRF Token para prote√ß√£o de requisi√ß√µes -->
    <meta name="csrf-token" content="{{ csrf_token() }}">
    
    <!-- Meta tags anti-cache -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    
    <title>Sistema Financeiro</title>
    
    <!-- üî• BUILD: {{ build_timestamp }} - SEMPRE ATUALIZADO üî• -->
    
    <link rel="icon" type="image/svg+xml" href="/static/favicon.svg">
    
    <!-- SUPRESSOR DE ERROS DE EXTENS√ïES - DEVE SER A PRIMEIRA COISA -->
    <script>
        (function() {
            window.addEventListener('error', function(e) {
                if (e.message && (e.message.includes('message channel closed') || 
                                  e.message.includes('Extension context invalidated') ||
                                  e.message.includes('chrome-extension'))) {
                    e.stopPropagation();
                    e.preventDefault();
                    return true;
                }
            }, true);
            
            window.addEventListener('unhandledrejection', function(e) {
                if (e.reason && e.reason.message && 
                    (e.reason.message.includes('message channel closed') || 
                     e.reason.message.includes('Extension context invalidated') ||
                     e.reason.message.includes('chrome-extension'))) {
                    e.stopPropagation();
                    e.preventDefault();
                }
            }, true);
        })();
    </script>
    
    <!-- Fun√ß√µes essenciais dispon√≠veis imediatamente -->
    <script>
        // Fun√ß√£o para toggle de submenus - COM DEBUG E PROTE√á√ÉO DE ERRO
        window.toggleSubmenu = function(submenuId) {
            try {
                console.log('üîç toggleSubmenu chamada com ID:', submenuId);
                
                const submenu = document.getElementById('submenu-' + submenuId);
                const button = document.getElementById('btn-' + submenuId);
                
                console.log('üìç Submenu element:', submenu);
                console.log('üìç Button element:', button);
                
                if (!submenu || !button) {
                    console.error('‚ùå Elementos n√£o encontrados!');
                    console.error('   submenu ID procurado:', 'submenu-' + submenuId);
                    console.error('   button ID procurado:', 'btn-' + submenuId);
                    return;
                }
                
                // Verificar estado atual
                const currentDisplay = window.getComputedStyle(submenu).display;
                const isHidden = currentDisplay === 'none';
                
                console.log('üìä Display atual:', currentDisplay);
                console.log('üìä Est√° oculto?', isHidden);
                
                if (isHidden) {
                    console.log('‚û°Ô∏è Mostrando submenu...');
                    submenu.style.display = 'block';
                    button.classList.add('active');
                } else {
                    console.log('‚û°Ô∏è Ocultando submenu...');
                    submenu.style.display = 'none';
                    button.classList.remove('active');
                }
                
                console.log('‚úÖ Toggle conclu√≠do. Novo display:', submenu.style.display);
            } catch (error) {
                console.error('üí• ERRO em toggleSubmenu:', error);
                console.error('Stack:', error.stack);
            }
        };
        
        // Garantir que est√° no escopo global
        console.log('‚úÖ toggleSubmenu definida no escopo window');
        
        // Fun√ß√£o para mostrar se√ß√µes
        function showSection(sectionId) {
            // Ocultar todas as se√ß√µes
            const sections = document.querySelectorAll('.content-card');
            sections.forEach(section => section.classList.add('hidden'));
            
            // Mostrar a se√ß√£o selecionada
            const targetSection = document.getElementById(sectionId + '-section');
            if (targetSection) {
                targetSection.classList.remove('hidden');
            }
            
            // Atualizar bot√µes de navega√ß√£o
            const navButtons = document.querySelectorAll('.nav-button');
            navButtons.forEach(button => button.classList.remove('active'));
        }
    </script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
            min-height: 100vh;
        }

        /* For√ßa mai√∫sculas em todos os inputs e textareas, exceto email e password */
        input[type="text"],
        input:not([type="date"]):not([type="month"]):not([type="email"]):not([type="password"]):not([type="number"]):not([id*="calc"]),
        textarea {
            text-transform: uppercase !important;
        }

        input[type="email"] {
            text-transform: lowercase !important;
        }

        .container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 280px;
            background: #2c3e50;
            color: white;
            padding: 20px 0;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            transition: transform 0.3s ease;
        }

        .sidebar.hidden {
            transform: translateX(-280px);
        }

        .sidebar-header {
            text-align: center;
            font-size: 20px;
            font-weight: bold;
            padding: 20px;
            color: #3498db;
            border-bottom: 2px solid #34495e;
            margin-bottom: 20px;
        }

        .nav-button {
            width: 100%;
            padding: 15px 25px;
            background: transparent;
            border: none;
            color: white;
            text-align: left;
            font-size: 15px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 12px;
            position: relative;
            user-select: none;
        }

        .nav-button:hover {
            background: #34495e;
        }

        .nav-button.active {
            background: #3498db;
            border-left: 4px solid #fff;
        }

        .nav-button:hover {
            background: #3498db;
            border-left: 4px solid #fff;
        }

        /* Submenu styles */
        .submenu {
            background: #1a252f;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .submenu-button {
            width: 100%;
            padding: 12px 25px 12px 45px;
            background: transparent;
            border: none;
            color: #b0b0b0;
            text-align: left;
            font-size: 15px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .submenu-button:hover {
            background: #243447;
            color: #3498db;
            padding-left: 50px;
        }

        /* Main Content */
        .main-content {
            margin-left: 280px;
            flex: 1;
            padding: 30px;
            transition: margin-left 0.3s ease;
        }

        .main-content.expanded {
            margin-left: 0;
        }

        .content-card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .toggle-sidebar-btn {
            position: fixed;
            top: 15px;
            left: 290px;
            z-index: 1000;
            background: #2c3e50;
            color: white;
            border: 2px solid #3498db;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
        }

        .toggle-sidebar-btn:hover {
            background: #3498db;
            transform: rotate(90deg);
        }

        .sidebar.hidden + .toggle-sidebar-btn {
            left: 15px;
            background: #3498db;
        }

        .toggle-sidebar-btn.sidebar-hidden {
            left: 20px;
        }

        h2 {
            color: #000000;
            margin-bottom: 25px;
            font-size: 28px;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }

        /* Buttons */
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 15px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .btn-primary {
            background: #3498db;
            color: white;
        }

        .btn-primary:hover {
            background: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
        }

        .btn-success {
            background: #27ae60;
            color: white;
        }

        .btn-success:hover {
            background: #229954;
        }

        .btn-info {
            background: #17a2b8;
            color: white;
        }

        .btn-info:hover {
            background: #138496;
        }

        .btn-danger {
            background: #e74c3c;
            color: white;
        }

        .btn-danger:hover {
            background: #c0392b;
        }

        .btn-secondary {
            background: #95a5a6;
            color: white;
        }

        .btn-secondary:hover {
            background: #7f8c8d;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 13px;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.6);
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Status de lan√ßamentos */
        .status-pago {
            color: #27ae60;
            font-weight: 600;
            background: #d5f4e6;
            padding: 5px 12px;
            border-radius: 6px;
            display: inline-block;
        }

        .status-pendente {
            color: #f39c12;
            font-weight: 600;
            background: #fef5e7;
            padding: 5px 12px;
            border-radius: 6px;
            display: inline-block;
        }

        .status-vencido {
            color: #e74c3c;
            font-weight: 600;
            background: #fadbd8;
            padding: 5px 12px;
            border-radius: 6px;
            display: inline-block;
            animation: pulse 2s infinite;
        }

        .status-cancelado {
            color: #95a5a6;
            font-weight: 600;
            background: #ecf0f1;
            padding: 5px 12px;
            border-radius: 6px;
            display: inline-block;
            text-decoration: line-through;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .modal-content {
            background-color: #fefefe;
            margin: 3% auto;
            padding: 0;
            border-radius: 15px;
            width: 90%;
            max-width: 700px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            animation: slideIn 0.3s;
        }

        @keyframes slideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 30px;
            border-radius: 15px 15px 0 0;
            font-size: 24px;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .close {
            color: white;
            font-size: 32px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .close:hover {
            transform: scale(1.2);
            color: #ffcccc;
        }

        .modal-content form {
            padding: 30px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #2c3e50;
            font-weight: 600;
            font-size: 14px;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ecf0f1;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s;
            font-family: inherit;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        /* Tables */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 0;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }

        td:first-child {
            text-align: center;
            vertical-align: middle;
        }

        th {
            background: #34495e;
            color: white;
            font-weight: 600;
            position: sticky;
            top: 0;
            z-index: 10;
            border-bottom: 2px solid #2c3e50;
        }

        tbody tr {
            cursor: default;
            border-bottom: 1px solid #e0e0e0;
        }

        tbody tr:hover {
            background: #f8f9fa;
        }

        tbody tr:last-child td {
            border-bottom: 2px solid #e0e0e0;
        }

        td, th {
            user-select: none;
        }

        td:first-child,
        th:first-child {
            width: 50px;
            text-align: center;
        }

        td input[type="checkbox"],
        th input[type="checkbox"] {
            cursor: pointer !important;
            user-select: auto;
        }

        /* Containers com scroll para tabelas de cadastros */
        .table-scroll-container {
            max-height: calc(22 * 48px + 48px);
            overflow-y: auto;
            overflow-x: hidden;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            margin-top: 15px;
        }

        .table-scroll-container table {
            margin: 0;
        }

        .table-scroll-container thead th {
            position: sticky;
            top: 0;
            z-index: 10;
            background: #34495e;
        }

        /* Largura das colunas Raz√£o Social */
        #table-clientes th:nth-child(1),
        #table-clientes td:nth-child(1),
        #table-fornecedores th:nth-child(1),
        #table-fornecedores td:nth-child(1) {
            min-width: 300px;
            max-width: 400px;
            width: 35%;
        }

        /* Largura da coluna Banco em Contas Banc√°rias */
        #table-contas th:nth-child(1),
        #table-contas td:nth-child(1) {
            min-width: 250px;
            width: 30%;
        }

        /* Largura das colunas em Categorias */
        #table-categorias-receita th:nth-child(1),
        #table-categorias-receita td:nth-child(1),
        #table-categorias-despesa th:nth-child(1),
        #table-categorias-despesa td:nth-child(1) {
            min-width: 300px;
            width: 70%;
        }

        #table-categorias-receita th:nth-child(2),
        #table-categorias-receita td:nth-child(2),
        #table-categorias-despesa th:nth-child(2),
        #table-categorias-despesa td:nth-child(2) {
            width: 30%;
            text-align: center;
        }

        /* Badge contador de subcategorias */
        .subcategoria-badge {
            display: inline-block;
            background: #4CAF50;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: bold;
            margin-right: 5px;
        }

        /* Modal de Subcategorias */
        .modal-subcategorias-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 10000;
            animation: fadeIn 0.3s;
        }

        .modal-subcategorias-overlay.active {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .modal-subcategorias-content {
            background: white;
            border-radius: 12px;
            padding: 0;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow: hidden;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            animation: slideIn 0.3s;
            display: flex;
            flex-direction: column;
        }

        .modal-subcategorias-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px 30px;
            border-radius: 12px 12px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-subcategorias-header h3 {
            margin: 0;
            font-size: 1.4em;
            font-weight: 600;
        }

        .modal-subcategorias-close {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .modal-subcategorias-close:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: rotate(90deg);
        }

        .modal-subcategorias-body {
            padding: 30px;
            overflow-y: auto;
            flex: 1;
        }

        .subcategorias-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .subcategorias-list li {
            background: #f8f9fa;
            padding: 15px 20px;
            margin-bottom: 10px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
            font-size: 1.05em;
            transition: all 0.3s;
            display: flex;
            align-items: center;
        }

        .subcategorias-list li:hover {
            background: #e9ecef;
            transform: translateX(5px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .subcategorias-list li::before {
            content: "üìå";
            margin-right: 12px;
            font-size: 1.1em;
        }

        .subcategorias-empty {
            text-align: center;
            padding: 40px 20px;
            color: #95a5a6;
        }

        .subcategorias-empty-icon {
            font-size: 4em;
            margin-bottom: 15px;
        }

        .subcategorias-empty-text {
            font-size: 1.1em;
            font-weight: 500;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            overflow-y: auto;
        }

        .modal-content {
            background: white;
            margin: 50px auto;
            padding: 30px;
            border-radius: 15px;
            max-width: 700px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            animation: slideDown 0.3s;
        }

        @keyframes slideDown {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            font-size: 24px;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #3498db;
        }

        .close {
            float: right;
            font-size: 28px;
            font-weight: bold;
            color: #95a5a6;
            cursor: pointer;
            transition: color 0.3s;
        }

        .close:hover {
            color: #e74c3c;
        }

        /* Form */
        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #000000;
            font-weight: 600;
            font-size: 14px;
        }

        input:not([type="checkbox"]), select, textarea {
            width: 100%;
            padding: 12px;
            border: 3px solid #2c3e50;
            border-radius: 8px;
            font-size: 14px;
            transition: border 0.3s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer !important;
            margin: 0;
            padding: 0;
            display: inline-block;
            position: relative;
            flex-shrink: 0;
            pointer-events: auto !important;
            vertical-align: middle;
        }

        input[type="checkbox"]:hover:not(:disabled) {
            opacity: 0.8;
        }

        input[type="checkbox"]:checked {
            accent-color: #3498db;
        }

        input[type="checkbox"]:disabled {
            opacity: 0.3;
            cursor: not-allowed !important;
        }

        /* Estilo para label do checkbox */
        td label {
            cursor: pointer !important;
            user-select: none;
            margin: 0 !important;
            padding: 0 !important;
        }

        td label:hover .checkbox-icon {
            transform: scale(1.2);
            transition: transform 0.2s;
        }

        input:not([type="checkbox"]):focus, select:focus, textarea:focus {
            outline: none;
            border-color: #3498db;
            border-width: 3px;
            box-shadow: 0 3px 8px rgba(52, 152, 219, 0.3);
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        /* Dashboard Stats */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .stat-label {
            font-size: 12px;
            opacity: 0.9;
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 24px;
            font-weight: bold;
        }

        /* Filters */
        .filters {
            background: #f8f9fa;
            padding: 12px 15px;
            border-radius: 10px;
            margin-bottom: 8px;
            border: none;
        }

        .filters select,
        .filters input[type="date"],
        .filters input[type="text"],
        .filters input[type="number"] {
            border: 1px solid #ddd;
            background: white;
            padding: 6px 10px;
            font-size: 13px;
        }

        .filters label {
            font-size: 12px;
            margin-bottom: 4px;
        }

        .filter-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-bottom: 8px;
        }

        /* Loading */
        .loading {
            text-align: center;
            padding: 40px;
            color: #7f8c8d;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #95a5a6;
        }

        .empty-state-icon {
            font-size: 64px;
            margin-bottom: 20px;
        }

        /* Toast Notifications */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10000;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .toast {
            min-width: 300px;
            padding: 16px 20px;
            border-radius: 12px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.15);
            display: flex;
            align-items: center;
            gap: 12px;
            animation: slideInRight 0.4s ease-out;
            font-weight: 500;
            position: relative;
            overflow: hidden;
        }

        .toast::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 4px;
        }

        .toast-success {
            background: white;
            color: #155724;
            border-left: 4px solid #28a745;
        }

        .toast-success .toast-icon {
            color: #28a745;
            font-size: 24px;
        }

        .toast-error {
            background: white;
            color: #721c24;
            border-left: 4px solid #dc3545;
        }

        .toast-error .toast-icon {
            color: #dc3545;
            font-size: 24px;
        }

        .toast-info {
            background: white;
            color: #0c5460;
            border-left: 4px solid #17a2b8;
        }

        .toast-info .toast-icon {
            color: #17a2b8;
            font-size: 24px;
        }

        .toast-warning {
            background: white;
            color: #856404;
            border-left: 4px solid #ffc107;
        }

        .toast-warning .toast-icon {
            color: #ffc107;
            font-size: 24px;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOutRight {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(400px);
                opacity: 0;
            }
        }

        .toast.hiding {
            animation: slideOutRight 0.3s ease-in forwards;
        }

        /* Confirm Dialog */
        .confirm-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            animation: fadeIn 0.2s;
        }

        .confirm-dialog {
            background: white;
            border-radius: 16px;
            padding: 30px;
            max-width: 450px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            animation: scaleIn 0.3s ease-out;
        }

        .confirm-icon {
            font-size: 48px;
            text-align: center;
            margin-bottom: 20px;
        }

        .confirm-title {
            font-size: 22px;
            font-weight: bold;
            color: #2c3e50;
            text-align: center;
            margin-bottom: 12px;
        }

        .confirm-message {
            font-size: 16px;
            color: #7f8c8d;
            text-align: center;
            margin-bottom: 25px;
            line-height: 1.5;
        }

        .confirm-buttons {
            display: flex;
            gap: 12px;
            justify-content: center;
        }

        .confirm-btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .confirm-btn-yes {
            background: #e74c3c;
            color: white;
        }

        .confirm-btn-yes:hover {
            background: #c0392b;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(231, 76, 60, 0.3);
        }

        .confirm-btn-no {
            background: #ecf0f1;
            color: #2c3e50;
        }

        .confirm-btn-no:hover {
            background: #bdc3c7;
        }

        @keyframes scaleIn {
            from {
                transform: scale(0.8);
                opacity: 0;
            }
            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
                opacity: 1;
            }
            50% {
                transform: scale(1.1);
                opacity: 0.8;
            }
        }

        /* Badge de inadimpl√™ncia */
        .badge-inadimplencia {
            display: inline-block;
            background: #95a5a6;
            color: white;
            font-size: 11px;
            font-weight: bold;
            padding: 3px 8px;
            border-radius: 12px;
            margin-left: 8px;
            min-width: 20px;
            text-align: center;
        }

        /* Old alerts - hidden */
        .alert {
            display: none !important;
        }

        /* Hidden */
        .hidden {
            display: none;
        }

        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 5px;
        }

        /* Tab Buttons */
        .tab-button {
            padding: 12px 30px;
            border: none;
            background: transparent;
            color: #666;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
            margin-right: 10px;
        }

        .tab-button:hover {
            color: #3498db;
            background: rgba(52, 152, 219, 0.05);
        }

        .tab-button.active {
            color: #3498db;
            border-bottom-color: #3498db;
            background: rgba(52, 152, 219, 0.1);
        }

        /* Tabs */
        .tab-button {
            padding: 12px 24px;
            border: none;
            background: transparent;
            font-size: 14px;
            font-weight: 600;
            color: #666;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }

        .tab-button:hover {
            color: #667eea;
            background: rgba(102, 126, 234, 0.05);
        }

        .tab-button.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        body.dark-mode .indicador-analise p {
            color: #e0e0e0 !important;
        }

        body.dark-mode .indicador-analise strong {
            color: #64b5f6 !important;
        }

        /* Diminuir fonte das tabelas de contas a pagar e receber */
        #contas-receber-section table,
        #contas-pagar-section table {
            font-size: 13px;
        }

        #contas-receber-section table th,
        #contas-pagar-section table th {
            font-size: 13px;
            padding: 10px 8px;
        }

        #contas-receber-section table td,
        #contas-pagar-section table td {
            font-size: 13px;
            padding: 8px;
        }

        #contas-receber-section .btn-small,
        #contas-pagar-section .btn-small {
            padding: 4px 8px;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">üí∞ Sistema Financeiro</div>
            
            <!-- User Info Header -->
            <div class="user-info" style="padding: 15px 20px; border-bottom: 1px solid #34495e; margin-bottom: 15px;">
                <div style="color: #fff; font-size: 14px; margin-bottom: 8px;">
                    <strong id="userNameSidebar">üë§ Carregando...</strong>
                </div>
                <div style="color: #95a5a6; font-size: 12px; margin-bottom: 10px;">
                    <span id="userTypeSidebar">-</span>
                </div>
                <div style="display: flex; gap: 5px;">
                    <button id="adminBtn" onclick="window.location.href='/admin'" style="display: none; flex: 1; padding: 6px; background: #e74c3c; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px;">‚öôÔ∏è Admin</button>
                    <button onclick="logoutUser()" style="flex: 1; padding: 6px; background: #34495e; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px;">üö™ Sair</button>
                </div>
            </div>
            
            <button class="nav-button active" onclick="showSection('dashboard')" data-permission="dashboard">
                üìä Dashboard
            </button>
            
            <!-- Menu Financeiro com Submenu -->
            <button class="nav-button" onclick="console.log('üñ±Ô∏è BOT√ÉO FINANCEIRO CLICADO!'); toggleSubmenu('financeiro')" id="btn-financeiro" data-permission="lancamentos_view">
                üí∞ Financeiro ‚ñº
            </button>
            <div class="submenu" id="submenu-financeiro" style="display: none;">
                <button class="submenu-button" onclick="showSection('contas-receber')" data-permission="lancamentos_view">üíµ Contas a Receber</button>
                <button class="submenu-button" onclick="showSection('contas-pagar')" data-permission="lancamentos_view">üí≥ Contas a Pagar</button>
                <button class="submenu-button" onclick="showSection('extrato-bancario')" data-permission="lancamentos_view">üè¶ Extrato Banc√°rio</button>
            </div>
            
            <!-- Menu de Relat√≥rios com Submenu -->
            <button class="nav-button" onclick="console.log('üñ±Ô∏è BOT√ÉO RELAT√ìRIOS CLICADO!'); toggleSubmenu('relatorios')" id="btn-relatorios" data-permission="relatorios_view">
                üìä Relat√≥rios ‚ñº
            </button>
            <div class="submenu" id="submenu-relatorios" style="display: none;">
                <button class="submenu-button" onclick="showSection('fluxo-caixa')" data-permission="relatorios_view">üìà Fluxo de Caixa</button>
                <button class="submenu-button" onclick="showSection('analise-detalhada')" data-permission="relatorios_view">üìä An√°lise Detalhada</button>
                <button class="submenu-button" onclick="showSection('comparativo-periodos')" data-permission="relatorios_view">üìâ Comparativo de Per√≠odos</button>
                <button class="submenu-button" onclick="showSection('indicadores')" data-permission="relatorios_view">üéØ Indicadores Financeiros</button>
                <button class="submenu-button" onclick="showSection('inadimplencia')" data-permission="relatorios_view">‚ö†Ô∏è Inadimpl√™ncia <span id="badge-inadimplencia" class="badge-inadimplencia">0</span></button>
            </div>
            
            <!-- Menu de Cadastros com Submenu -->
            <button class="nav-button" onclick="toggleSubmenu('cadastros')" id="btn-cadastros" data-permission="cadastros_view">
                üìã Cadastros ‚ñº
            </button>
            <div class="submenu" id="submenu-cadastros" style="display: none;">
                <button class="submenu-button" onclick="showSection('contas-bancarias')" data-permission="contas_bancarias_view">üè¶ Contas Banc√°rias</button>
                <button class="submenu-button" onclick="showSection('categorias')" data-permission="categorias_view">üìÅ Categorias</button>
                <button class="submenu-button" onclick="showSection('clientes')" data-permission="clientes_view">üë§ Clientes</button>
                <button class="submenu-button" onclick="showSection('fornecedores')" data-permission="fornecedores_view">üè≠ Fornecedores</button>
                <button class="submenu-button" onclick="showSection('tipos-sessao')" data-permission="tipos_sessao_view">üì∏ Tipos de Sess√£o</button>
            </div>
            
            <!-- Menu Operacional com Submenu -->
            <button class="nav-button" onclick="toggleSubmenu('operacional')" id="btn-operacional" data-permission="operacional_view">
                ‚öôÔ∏è Operacional ‚ñº
            </button>
            <div class="submenu" id="submenu-operacional" style="display: none;">
                <button class="submenu-button" onclick="showSection('contratos')" data-permission="contratos_view">üìã Contratos e Sess√µes</button>
                <button class="submenu-button" onclick="showSection('agenda-fotografia')" data-permission="agenda_view">üì∑ Agenda de Fotografia</button>
                <button class="submenu-button" onclick="showSection('gestao-estoque')" data-permission="estoque_view">üì¶ Gest√£o de Estoque</button>
                <button class="submenu-button" onclick="showSection('kits-equipamentos')" data-permission="estoque_view">üéí Kits de Equipamentos</button>
                <button class="submenu-button" onclick="showSection('tags-trabalho')" data-permission="contratos_view">üè∑Ô∏è Tags de Trabalho</button>
                <button class="submenu-button" onclick="showSection('templates-equipe')" data-permission="contratos_view">üë• Templates de Equipe</button>
            </div>
        </div>

        <!-- Bot√£o Toggle Sidebar -->
        <button class="toggle-sidebar-btn" onclick="toggleSidebar()" title="Ocultar/Mostrar Menu">
            ¬´
        </button>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Toast Container -->
            <div id="toast-container" class="toast-container"></div>

            <!-- Dashboard -->
            <div id="dashboard-section" class="content-card">
                <h2>üìä Dashboard Financeiro</h2>
                
                <!-- Filtros -->
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 25px; border-radius: 16px; margin-bottom: 25px; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);">
                    <div style="display: flex; gap: 15px; align-items: flex-end; flex-wrap: wrap;">
                        <div style="flex: 0 0 auto;">
                            <label style="font-weight: 600; margin-bottom: 8px; display: block; color: white; font-size: 13px; text-transform: uppercase; letter-spacing: 0.5px;">üìÖ Ano</label>
                            <input type="number" id="filter-ano-dashboard" placeholder="2025" min="2000" max="2100" 
                                   style="width: 120px; padding: 12px 16px; border: none; border-radius: 8px; font-size: 15px; font-weight: 600; 
                                          box-shadow: 0 2px 8px rgba(0,0,0,0.1); transition: all 0.3s; outline: none; background: white;"
                                   onfocus="this.style.boxShadow='0 4px 12px rgba(0,0,0,0.2)'; this.style.transform='translateY(-2px)';"
                                   onblur="this.style.boxShadow='0 2px 8px rgba(0,0,0,0.1)'; this.style.transform='translateY(0)';">
                        </div>
                        <div style="flex: 0 0 auto;">
                            <label style="font-weight: 600; margin-bottom: 8px; display: block; color: white; font-size: 13px; text-transform: uppercase; letter-spacing: 0.5px;">üìÜ M√™s</label>
                            <select id="filter-mes-dashboard" 
                                    style="width: 200px; padding: 12px 16px; border: none; border-radius: 8px; font-size: 15px; font-weight: 600;
                                           box-shadow: 0 2px 8px rgba(0,0,0,0.1); transition: all 0.3s; outline: none; cursor: pointer; background: white;
                                           appearance: none; -webkit-appearance: none; -moz-appearance: none; 
                                           background-image: url('data:image/svg+xml;charset=UTF-8,%3csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%2712%27 height=%278%27%3e%3cpath fill=%27%23667eea%27 d=%27M0 0l6 8 6-8z%27/%3e%3c/svg%3e');
                                           background-repeat: no-repeat; background-position: right 12px center; padding-right: 36px;"
                                    onfocus="this.style.boxShadow='0 4px 12px rgba(0,0,0,0.2)'; this.style.transform='translateY(-2px)';"
                                    onblur="this.style.boxShadow='0 2px 8px rgba(0,0,0,0.1)'; this.style.transform='translateY(0)';">
                                <option value="">Ano inteiro</option>
                                <option value="1">Janeiro</option>
                                <option value="2">Fevereiro</option>
                                <option value="3">Mar√ßo</option>
                                <option value="4">Abril</option>
                                <option value="5">Maio</option>
                                <option value="6">Junho</option>
                                <option value="7">Julho</option>
                                <option value="8">Agosto</option>
                                <option value="9">Setembro</option>
                                <option value="10">Outubro</option>
                                <option value="11">Novembro</option>
                                <option value="12">Dezembro</option>
                            </select>
                        </div>
                        <button onclick="carregarDashboard()" 
                                style="padding: 12px 32px; font-size: 15px; font-weight: 700; border: none; border-radius: 8px; 
                                       background: white; color: #667eea; cursor: pointer; transition: all 0.3s; 
                                       box-shadow: 0 2px 8px rgba(0,0,0,0.1); text-transform: uppercase; letter-spacing: 0.5px;
                                       display: flex; align-items: center; gap: 8px; height: 43px;"
                                onmouseover="this.style.background='#f8f9fa'; this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.2)';"
                                onmouseout="this.style.background='white'; this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(0,0,0,0.1)';"
                                onmousedown="this.style.transform='translateY(0)'; this.style.boxShadow='0 1px 4px rgba(0,0,0,0.1)';"
                                onmouseup="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.2)';">
                            <span style="font-size: 18px;">üîç</span>
                            <span>Atualizar</span>
                        </button>
                    </div>
                </div>
                
                <!-- Gr√°fico de Crescimento -->
                <div style="background: white; padding: 25px; border-radius: 12px; margin-bottom: 25px; box-shadow: 0 2px 8px rgba(0,0,0,0.08);">
                    <h3 style="margin: 0 0 20px 0; color: #2c3e50; font-size: 18px;">üìà Evolu√ß√£o Financeira</h3>
                    <canvas id="grafico-crescimento" style="max-height: 400px;"></canvas>
                </div>
                
                <!-- An√°lises Detalhadas -->
                <div id="dashboard-analises-content"></div>
            </div>

            <!-- Contas a Receber -->
            <div id="contas-receber-section" class="content-card hidden">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2 style="margin: 0;">Contas a Receber</h2>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn btn-primary" onclick="openModalReceita()" style="padding: 8px 16px; font-size: 13px;">‚ûï Nova Receita</button>
                        <button class="btn btn-primary" onclick="exportarContasReceberPDF()" style="padding: 8px 16px; font-size: 13px; background: #e74c3c;">üìù PDF</button>
                        <button class="btn btn-primary" onclick="exportarContasReceberExcel()" style="padding: 8px 16px; font-size: 13px; background: #27ae60;">üìä Excel</button>
                    </div>
                </div>
                
                <div class="filters">
                    <div class="filter-row">
                        <div class="form-group">
                            <label>Status:</label>
                            <select id="filter-status-receber" onchange="loadContasReceber()">
                                <option value="" selected>Todos</option>
                                <option value="PENDENTE">Pendentes</option>
                                <option value="PAGO">Pagos</option>
                                <option value="CANCELADO">Cancelados</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Categoria:</label>
                            <select id="filter-categoria-receber" onchange="loadContasReceber()">
                                <option value="">Todas</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Raz√£o Social:</label>
                            <select id="filter-cliente" onchange="loadContasReceber()">
                                <option value="">Todos</option>
                            </select>
                        </div>
                    </div>
                    <div class="filter-row">
                        <div class="form-group">
                            <label>Ano:</label>
                            <input type="number" id="filter-ano-receber" placeholder="2025" min="2000" max="2100" onchange="loadContasReceber()">
                        </div>
                        <div class="form-group">
                            <label>M√™s:</label>
                            <select id="filter-mes-receber" onchange="loadContasReceber()">
                                <option value="">Todos</option>
                                <option value="01">Janeiro</option>
                                <option value="02">Fevereiro</option>
                                <option value="03">Mar√ßo</option>
                                <option value="04">Abril</option>
                                <option value="05">Maio</option>
                                <option value="06">Junho</option>
                                <option value="07">Julho</option>
                                <option value="08">Agosto</option>
                                <option value="09">Setembro</option>
                                <option value="10">Outubro</option>
                                <option value="11">Novembro</option>
                                <option value="12">Dezembro</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Data Inicial:</label>
                            <input type="date" id="filter-data-inicio-receber" onchange="loadContasReceber()">
                        </div>
                        <div class="form-group">
                            <label>Data Final:</label>
                            <input type="date" id="filter-data-fim-receber" onchange="loadContasReceber()">
                        </div>
                    </div>
                </div>

                <!-- Informa√ß√µes de Saldo -->
                <div style="margin-bottom: 8px;">
                    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 15px 20px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                        <div style="display: flex; justify-content: space-between; align-items: center; gap: 20px;">
                            <div style="flex: 0 0 auto;">
                                <div style="font-size: 13px; opacity: 0.9; margin-bottom: 5px;">üí∞ Saldo Total dos Bancos</div>
                                <div id="saldo-total-bancos-receber" style="font-size: 28px; font-weight: bold;">R$ 0,00</div>
                            </div>
                            <div style="flex: 1; max-width: 500px;">
                                <div style="font-size: 12px; opacity: 0.9; margin-bottom: 6px;">üè¶ Consultar Saldo por Banco:</div>
                                <div style="display: flex; align-items: center; gap: 12px;">
                                    <select id="select-banco-receber" onchange="atualizarSaldoBanco('receber')" style="flex: 1; padding: 10px; border: none; border-radius: 6px; font-size: 14px; background: rgba(255,255,255,0.9); color: #2c3e50; cursor: pointer;">
                                        <option value="">Selecione um banco</option>
                                    </select>
                                    <div id="saldo-banco-selecionado-receber" style="min-width: 150px; font-size: 22px; font-weight: 700; text-align: right; display: none;"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div style="margin-bottom: 5px; display: flex; gap: 10px; align-items: center;">
                    <button class="btn btn-success" onclick="liquidarEmMassa('RECEITA')" style="display: none;" id="btn-liquidar-massa-receber">üí∞ Liquidar Selecionados</button>
                    <button class="btn btn-danger" onclick="excluirEmMassa('RECEITA')" style="display: none;" id="btn-excluir-massa-receber">üóëÔ∏è Excluir Selecionados</button>
                    <div id="soma-selecionados-receber" style="display: none; margin-left: auto; padding: 8px 16px; background: #e3f2fd; border: 2px solid #2196F3; border-radius: 4px; font-weight: bold; color: #1976D2; font-size: 14px;">
                        Total Selecionado: <span id="valor-soma-receber">R$ 0,00</span>
                    </div>
                </div>

                <div style="max-height: 950px; overflow-y: auto; overflow-x: auto; border: 1px solid #ddd; border-radius: 4px;">
                    <table id="table-receber">
                        <thead>
                            <tr>
                                <th style="width: 40px;"><input type="checkbox" id="select-all-receber" onchange="toggleSelectAll('receber')"></th>
                                <th>Vencimento</th>
                                <th>Raz√£o Social</th>
                                <th>N¬∫ Documento</th>
                                <th>Descri√ß√£o</th>
                                <th>Categoria</th>
                                <th>Subcategoria</th>
                                <th>Valor</th>
                                <th>Status</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="tbody-receber">
                            <tr><td colspan="10" class="loading">Carregando...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Contas a Pagar -->
            <div id="contas-pagar-section" class="content-card hidden">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2 style="margin: 0;">Contas a Pagar</h2>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn btn-primary" onclick="openModalDespesa()" style="padding: 8px 16px; font-size: 13px;">‚ûï Nova Despesa</button>
                        <button class="btn btn-primary" onclick="exportarContasPagarPDF()" style="padding: 8px 16px; font-size: 13px; background: #e74c3c;">üìù PDF</button>
                        <button class="btn btn-primary" onclick="exportarContasPagarExcel()" style="padding: 8px 16px; font-size: 13px; background: #27ae60;">üìä Excel</button>
                    </div>
                </div>
                
                <div class="filters">
                    <div class="filter-row">
                        <div class="form-group">
                            <label>Status:</label>
                            <select id="filter-status-pagar" onchange="loadContasPagar()">
                                <option value="" selected>Todos</option>
                                <option value="PENDENTE">Pendentes</option>
                                <option value="PAGO">Pagos</option>
                                <option value="CANCELADO">Cancelados</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Categoria:</label>
                            <select id="filter-categoria-pagar" onchange="loadContasPagar()">
                                <option value="">Todas</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Raz√£o Social:</label>
                            <select id="filter-fornecedor" onchange="loadContasPagar()">
                                <option value="">Todos</option>
                            </select>
                        </div>
                    </div>
                    <div class="filter-row">
                        <div class="form-group">
                            <label>Ano:</label>
                            <input type="number" id="filter-ano-pagar" placeholder="2025" min="2000" max="2100" onchange="loadContasPagar()">
                        </div>
                        <div class="form-group">
                            <label>M√™s:</label>
                            <select id="filter-mes-pagar" onchange="loadContasPagar()">
                                <option value="">Todos</option>
                                <option value="01">Janeiro</option>
                                <option value="02">Fevereiro</option>
                                <option value="03">Mar√ßo</option>
                                <option value="04">Abril</option>
                                <option value="05">Maio</option>
                                <option value="06">Junho</option>
                                <option value="07">Julho</option>
                                <option value="08">Agosto</option>
                                <option value="09">Setembro</option>
                                <option value="10">Outubro</option>
                                <option value="11">Novembro</option>
                                <option value="12">Dezembro</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Data Inicial:</label>
                            <input type="date" id="filter-data-inicio-pagar" onchange="loadContasPagar()">
                        </div>
                        <div class="form-group">
                            <label>Data Final:</label>
                            <input type="date" id="filter-data-fim-pagar" onchange="loadContasPagar()">
                        </div>
                    </div>
                </div>

                <!-- Informa√ß√µes de Saldo -->
                <div style="margin-bottom: 8px;">
                    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 15px 20px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                        <div style="display: flex; justify-content: space-between; align-items: center; gap: 20px;">
                            <div style="flex: 0 0 auto;">
                                <div style="font-size: 13px; opacity: 0.9; margin-bottom: 5px;">üí∞ Saldo Total dos Bancos</div>
                                <div id="saldo-total-bancos-pagar" style="font-size: 28px; font-weight: bold;">R$ 0,00</div>
                            </div>
                            <div style="flex: 1; max-width: 500px;">
                                <div style="font-size: 12px; opacity: 0.9; margin-bottom: 6px;">üè¶ Consultar Saldo por Banco:</div>
                                <div style="display: flex; align-items: center; gap: 12px;">
                                    <select id="select-banco-pagar" onchange="atualizarSaldoBanco('pagar')" style="flex: 1; padding: 10px; border: none; border-radius: 6px; font-size: 14px; background: rgba(255,255,255,0.9); color: #2c3e50; cursor: pointer;">
                                        <option value="">Selecione um banco</option>
                                    </select>
                                    <div id="saldo-banco-selecionado-pagar" style="min-width: 150px; font-size: 22px; font-weight: 700; text-align: right; display: none;"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div style="margin-bottom: 5px; display: flex; gap: 10px; align-items: center;">
                    <button class="btn btn-success" onclick="liquidarEmMassa('DESPESA')" style="display: none;" id="btn-liquidar-massa-pagar">üí∞ Liquidar Selecionados</button>
                    <button class="btn btn-danger" onclick="excluirEmMassa('DESPESA')" style="display: none;" id="btn-excluir-massa-pagar">üóëÔ∏è Excluir Selecionados</button>
                    <div id="soma-selecionados-pagar" style="display: none; margin-left: auto; padding: 8px 16px; background: #ffebee; border: 2px solid #f44336; border-radius: 4px; font-weight: bold; color: #c62828; font-size: 14px;">
                        Total Selecionado: <span id="valor-soma-pagar">R$ 0,00</span>
                    </div>
                </div>

                <div style="max-height: 950px; overflow-y: auto; overflow-x: auto; border: 1px solid #ddd; border-radius: 4px;">
                    <table id="table-pagar">
                        <thead>
                            <tr>
                                <th style="width: 40px;"><input type="checkbox" id="select-all-pagar" onchange="toggleSelectAll('pagar')"></th>
                                <th>Vencimento</th>
                                <th>Raz√£o Social</th>
                                <th>N¬∫ Documento</th>
                                <th>Descri√ß√£o</th>
                                <th>Categoria</th>
                                <th>Subcategoria</th>
                                <th>Valor</th>
                                <th>Status</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="tbody-pagar">
                            <tr><td colspan="10" class="loading">Carregando...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Extrato Banc√°rio -->
            <div id="extrato-bancario-section" class="content-card hidden">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2 style="margin: 0;">üè¶ Extrato Banc√°rio - Importa√ß√£o OFX</h2>
                </div>

                <!-- Upload de Arquivo OFX -->
                <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px; border: 2px dashed #3498db;">
                    <h3 style="margin-top: 0; color: #2c3e50;">üì§ Importar Arquivo OFX</h3>
                    <div style="display: flex; gap: 15px; align-items: flex-end; flex-wrap: wrap;">
                        <div style="flex: 1; min-width: 250px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: bold; color: #555;">Conta Banc√°ria:</label>
                            <select id="conta-bancaria-extrato" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;" required>
                                <option value="">Selecione a conta...</option>
                            </select>
                        </div>
                        <div style="flex: 1; min-width: 250px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: bold; color: #555;">Arquivo OFX:</label>
                            <input type="file" id="arquivo-ofx" accept=".ofx" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;" required>
                        </div>
                        <button onclick="uploadExtratoOFX(event)" class="btn btn-primary" style="padding: 10px 30px; background: #3498db; border: none; border-radius: 4px; color: white; font-weight: bold; cursor: pointer; font-size: 14px;">
                            ‚¨ÜÔ∏è Enviar Arquivo
                        </button>
                    </div>
                    <p style="margin-top: 15px; margin-bottom: 0; color: #666; font-size: 13px;">
                        üí° <strong>Dica:</strong> Baixe o arquivo OFX do seu internet banking e importe aqui para visualizar suas transa√ß√µes banc√°rias.
                    </p>
                </div>

                <!-- Filtros -->
                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                    <h3 style="margin-top: 0; color: #2c3e50;">üîç Filtros</h3>
                    <div style="display: flex; gap: 15px; align-items: flex-end; flex-wrap: wrap;">
                        <div style="flex: 1; min-width: 200px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: bold; color: #555;">Conta:</label>
                            <select id="filtro-conta-extrato" onchange="loadExtratoTransacoes()" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                <option value="">Todas as contas</option>
                            </select>
                        </div>
                        <div style="flex: 1; min-width: 150px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: bold; color: #555;">Data In√≠cio:</label>
                            <input type="date" id="filtro-data-inicio-extrato" onchange="loadExtratoTransacoes()" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                        </div>
                        <div style="flex: 1; min-width: 150px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: bold; color: #555;">Data Fim:</label>
                            <input type="date" id="filtro-data-fim-extrato" onchange="loadExtratoTransacoes()" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                        </div>
                        <div style="flex: 1; min-width: 150px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: bold; color: #555;">Status:</label>
                            <select id="filtro-conciliado-extrato" onchange="loadExtratoTransacoes()" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                <option value="">Todos</option>
                                <option value="true">Conciliados</option>
                                <option value="false">N√£o conciliados</option>
                            </select>
                        </div>
                        <button onclick="limparFiltrosExtrato()" class="btn btn-secondary" style="padding: 8px 20px; background: #95a5a6; border: none; border-radius: 4px; color: white; cursor: pointer;">
                            üîÑ Limpar
                        </button>
                        <button onclick="deletarExtratoFiltrado()" class="btn btn-danger" style="padding: 8px 20px; background: #e74c3c; border: none; border-radius: 4px; color: white; cursor: pointer; font-weight: bold;">
                            üóëÔ∏è Deletar Extrato
                        </button>
                    </div>
                </div>

                <!-- Tabela de Transa√ß√µes -->
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th style="width: 100px;">Data</th>
                                <th style="width: 350px;">Descri√ß√£o</th>
                                <th style="width: 120px;">Valor</th>
                                <th style="width: 80px;">Tipo</th>
                                <th style="width: 120px;">Saldo</th>
                                <th style="width: 150px;">Conta</th>
                                <th style="width: 100px;">Status</th>
                                <th style="width: 150px;">A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="tbody-extrato">
                            <tr><td colspan="8" class="loading">Carregando...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Relat√≥rios (mantido para compatibilidade, mas n√£o usado) -->
            <div id="relatorios-section" class="content-card hidden">
                <h2>Relat√≥rios</h2>
                <p>Use o menu lateral para acessar os relat√≥rios dispon√≠veis.</p>
            </div>

            <!-- Fluxo de Caixa -->
            <div id="fluxo-caixa-section" class="content-card hidden">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2 style="margin: 0;">üìà Fluxo de Caixa</h2>
                    
                    <!-- Bot√µes de Exporta√ß√£o -->
                    <div style="display: flex; gap: 10px;">
                        <button class="btn btn-success" onclick="openModalTransferencia()" style="padding: 8px 16px; font-size: 13px; background: #3498db;">üîÑ Transfer√™ncia entre Contas</button>
                        <button class="btn btn-primary" onclick="gerarDRE()" style="padding: 8px 16px; font-size: 13px; background: #3498db;">üìà GERAR DRE</button>
                        <button class="btn btn-primary" onclick="exportarFluxoPDF()" style="padding: 8px 16px; font-size: 13px; background: #e74c3c;">üìù PDF</button>
                        <button class="btn btn-primary" onclick="exportarFluxoExcel()" style="padding: 8px 16px; font-size: 13px; background: #27ae60;">üìä Excel</button>
                    </div>
                </div>
                
                <!-- Filtros -->
                <div style="display: flex; gap: 15px; margin-bottom: 20px;">
                    <!-- Filtro de Per√≠odo -->
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                        <label style="display: block; margin-bottom: 10px; font-weight: bold; color: #2c3e50; font-size: 14px;">Filtrar Per√≠odo:</label>
                        <div style="display: flex; gap: 10px; align-items: flex-end; flex-wrap: wrap;">
                            <div style="display: flex; flex-direction: column;">
                                <label style="font-size: 12px; margin-bottom: 4px; color: #666;">Ano:</label>
                                <input type="number" id="filter-ano-fluxo" placeholder="2025" min="2000" max="2100" style="width: 80px; padding: 6px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                            <div style="display: flex; flex-direction: column;">
                                <label style="font-size: 12px; margin-bottom: 4px; color: #666;">M√™s:</label>
                                <select id="filter-mes-fluxo" style="width: 120px; padding: 6px; border: 1px solid #ddd; border-radius: 4px;">
                                    <option value="">Todos</option>
                                    <option value="01">Janeiro</option>
                                    <option value="02">Fevereiro</option>
                                    <option value="03">Mar√ßo</option>
                                    <option value="04">Abril</option>
                                    <option value="05">Maio</option>
                                    <option value="06">Junho</option>
                                    <option value="07">Julho</option>
                                    <option value="08">Agosto</option>
                                    <option value="09">Setembro</option>
                                    <option value="10">Outubro</option>
                                    <option value="11">Novembro</option>
                                    <option value="12">Dezembro</option>
                                </select>
                            </div>
                            <div style="display: flex; flex-direction: column;">
                                <label style="font-size: 12px; margin-bottom: 4px; color: #666;">Data Inicial:</label>
                                <input type="date" id="filter-data-inicial-fluxo" style="width: 140px; padding: 6px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                            <div style="display: flex; flex-direction: column;">
                                <label style="font-size: 12px; margin-bottom: 4px; color: #666;">Data Final:</label>
                                <input type="date" id="filter-data-final-fluxo" style="width: 140px; padding: 6px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Filtro de Banco -->
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                        <label style="display: block; margin-bottom: 10px; font-weight: bold; color: #2c3e50; font-size: 14px;">Filtrar Banco:</label>
                        <div style="display: flex; gap: 10px; align-items: flex-end;">
                            <div style="display: flex; flex-direction: column;">
                                <label style="font-size: 12px; margin-bottom: 4px; color: #666;">Banco:</label>
                                <select id="filter-banco-fluxo" style="width: 180px; padding: 6px; border: 1px solid #ddd; border-radius: 4px;">
                                    <option value="">Todos</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Bot√µes -->
                    <div style="display: flex; flex-direction: column; justify-content: flex-end; gap: 8px;">
                        <button class="btn btn-primary" onclick="carregarFluxoCaixa()" style="padding: 6px 12px; font-size: 13px;">üîç Pesquisar</button>
                        <button class="btn btn-primary" onclick="limparFiltrosFluxo()" style="padding: 6px 12px; font-size: 13px;">üîÑ Limpar</button>
                    </div>
                </div>
                
                <div id="fluxo-caixa-content" class="loading">Carregando...</div>
            </div>

            <!-- An√°lise Detalhada Unificada -->
            <div id="analise-detalhada-section" class="content-card hidden">
                <h2 style="margin: 0 0 20px 0;">üìä An√°lise Detalhada</h2>
                
                <!-- Abas de Navega√ß√£o -->
                <div style="border-bottom: 2px solid #e0e0e0; margin-bottom: 20px;">
                    <button class="tab-button active" onclick="trocarAbaAnalise('parceiros')" id="tab-parceiros" style="padding: 12px 24px; border: none; background: transparent; font-size: 14px; font-weight: 600; color: #666; cursor: pointer; border-bottom: 3px solid transparent; transition: all 0.3s;">
                        üìá Por Cliente/Fornecedor
                    </button>
                    <button class="tab-button" onclick="trocarAbaAnalise('categorias')" id="tab-categorias" style="padding: 12px 24px; border: none; background: transparent; font-size: 14px; font-weight: 600; color: #666; cursor: pointer; border-bottom: 3px solid transparent; transition: all 0.3s;">
                        üìÅ Por Categoria
                    </button>
                </div>
                
                <!-- Conte√∫do Aba Parceiros -->
                <div id="content-parceiros" class="tab-content">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3 style="margin: 0; color: #555; font-size: 18px;">Resumo por Cliente/Fornecedor</h3>
                        <div style="display: flex; gap: 10px;">
                            <button class="btn btn-primary" onclick="exportarResumoParceirosPDF()" style="padding: 8px 16px; font-size: 13px; background: #e74c3c;">üìù PDF</button>
                            <button class="btn btn-primary" onclick="exportarResumoParceirosExcel()" style="padding: 8px 16px; font-size: 13px; background: #27ae60;">üìä Excel</button>
                        </div>
                    </div>
                    
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                        <div style="display: flex; gap: 15px; align-items: flex-end; flex-wrap: wrap;">
                            <div>
                                <label style="font-size: 12px; color: #666; display: block; margin-bottom: 4px;">Ano:</label>
                                <input type="number" id="filter-ano-parceiros" placeholder="2025" style="width: 100px; padding: 8px 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; height: 38px;">
                            </div>
                            <div>
                                <label style="font-size: 12px; color: #666; display: block; margin-bottom: 4px;">M√™s:</label>
                                <select id="filter-mes-parceiros" style="padding: 8px 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; height: 38px; min-width: 150px;">
                                    <option value="">Ano inteiro</option>
                                    <option value="1">Janeiro</option>
                                    <option value="2">Fevereiro</option>
                                    <option value="3">Mar√ßo</option>
                                    <option value="4">Abril</option>
                                    <option value="5">Maio</option>
                                    <option value="6">Junho</option>
                                    <option value="7">Julho</option>
                                    <option value="8">Agosto</option>
                                    <option value="9">Setembro</option>
                                    <option value="10">Outubro</option>
                                    <option value="11">Novembro</option>
                                    <option value="12">Dezembro</option>
                                </select>
                            </div>
                            <div style="margin-bottom: 0;">
                                <label style="font-size: 12px; color: transparent; display: block; margin-bottom: 4px; user-select: none;">&#8203;</label>
                                <button class="btn btn-primary" onclick="carregarResumoParceiros()" style="padding: 8px 16px; height: 38px; font-size: 14px;">üîç Gerar Relat√≥rio</button>
                            </div>
                        </div>
                    </div>
                    
                    <div id="resumo-parceiros-content">Carregando...</div>
                </div>
                
                <!-- Conte√∫do Aba Categorias -->
                <div id="content-categorias" class="tab-content" style="display: none;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3 style="margin: 0; color: #555; font-size: 18px;">An√°lise por Categoria</h3>
                        <div style="display: flex; gap: 10px;">
                            <button class="btn btn-primary" onclick="exportarAnaliseCategoriasPDF()" style="padding: 8px 16px; font-size: 13px; background: #e74c3c;">üìù PDF</button>
                            <button class="btn btn-primary" onclick="exportarAnaliseCategoriasExcel()" style="padding: 8px 16px; font-size: 13px; background: #27ae60;">üìä Excel</button>
                        </div>
                    </div>
                    
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                        <div style="display: flex; gap: 15px; align-items: flex-end; flex-wrap: wrap;">
                            <div>
                                <label style="font-size: 12px; color: #666; display: block; margin-bottom: 4px;">Ano:</label>
                                <input type="number" id="filter-ano-categorias" placeholder="2025" style="width: 100px; padding: 6px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                            <div>
                                <label style="font-size: 12px; color: #666; display: block; margin-bottom: 4px;">M√™s:</label>
                                <select id="filter-mes-categorias" style="padding: 6px; border: 1px solid #ddd; border-radius: 4px;">
                                    <option value="">Ano inteiro</option>
                                    <option value="1">Janeiro</option>
                                    <option value="2">Fevereiro</option>
                                    <option value="3">Mar√ßo</option>
                                    <option value="4">Abril</option>
                                    <option value="5">Maio</option>
                                    <option value="6">Junho</option>
                                    <option value="7">Julho</option>
                                    <option value="8">Agosto</option>
                                    <option value="9">Setembro</option>
                                    <option value="10">Outubro</option>
                                    <option value="11">Novembro</option>
                                    <option value="12">Dezembro</option>
                                </select>
                            </div>
                            <button class="btn btn-primary" onclick="carregarAnaliseCategorias()" style="padding: 6px 16px;">üîç Gerar An√°lise</button>
                        </div>
                    </div>
                    
                    <div id="analise-categorias-content">Carregando...</div>
                </div>
            </div>

            <!-- Comparativo Per√≠odos -->
            <div id="comparativo-periodos-section" class="content-card hidden">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2 style="margin: 0;">üìâ Comparativo de Per√≠odos</h2>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn btn-primary" onclick="exportarComparativoPDF()" style="padding: 8px 16px; font-size: 13px; background: #e74c3c;">üìù PDF</button>
                        <button class="btn btn-primary" onclick="exportarComparativoExcel()" style="padding: 8px 16px; font-size: 13px; background: #27ae60;">üìä Excel</button>
                    </div>
                </div>
                
                <!-- Filtros -->
                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div>
                            <h4 style="margin: 0 0 10px 0; color: #3498db;">Per√≠odo 1:</h4>
                            <div style="display: flex; gap: 10px;">
                                <div style="flex: 1;">
                                    <label style="font-size: 12px; color: #666; display: block; margin-bottom: 4px;">Ano:</label>
                                    <input type="number" id="filter-ano1" placeholder="2025" min="2000" max="2100" style="width: 100%; padding: 6px; border: 1px solid #ddd; border-radius: 4px;">
                                </div>
                                <div style="flex: 1;">
                                    <label style="font-size: 12px; color: #666; display: block; margin-bottom: 4px;">M√™s:</label>
                                    <select id="filter-mes1" style="width: 100%; padding: 6px; border: 1px solid #ddd; border-radius: 4px;">
                                        <option value="">Ano inteiro</option>
                                        <option value="1">Janeiro</option>
                                        <option value="2">Fevereiro</option>
                                        <option value="3">Mar√ßo</option>
                                        <option value="4">Abril</option>
                                        <option value="5">Maio</option>
                                        <option value="6">Junho</option>
                                        <option value="7">Julho</option>
                                        <option value="8">Agosto</option>
                                        <option value="9">Setembro</option>
                                        <option value="10">Outubro</option>
                                        <option value="11">Novembro</option>
                                        <option value="12">Dezembro</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div>
                            <h4 style="margin: 0 0 10px 0; color: #e74c3c;">Per√≠odo 2:</h4>
                            <div style="display: flex; gap: 10px;">
                                <div style="flex: 1;">
                                    <label style="font-size: 12px; color: #666; display: block; margin-bottom: 4px;">Ano:</label>
                                    <input type="number" id="filter-ano2" placeholder="2025" min="2000" max="2100" style="width: 100%; padding: 6px; border: 1px solid #ddd; border-radius: 4px;">
                                </div>
                                <div style="flex: 1;">
                                    <label style="font-size: 12px; color: #666; display: block; margin-bottom: 4px;">M√™s:</label>
                                    <select id="filter-mes2" style="width: 100%; padding: 6px; border: 1px solid #ddd; border-radius: 4px;">
                                        <option value="">Ano inteiro</option>
                                        <option value="1">Janeiro</option>
                                        <option value="2">Fevereiro</option>
                                        <option value="3">Mar√ßo</option>
                                        <option value="4">Abril</option>
                                        <option value="5">Maio</option>
                                        <option value="6">Junho</option>
                                        <option value="7">Julho</option>
                                        <option value="8">Agosto</option>
                                        <option value="9">Setembro</option>
                                        <option value="10">Outubro</option>
                                        <option value="11">Novembro</option>
                                        <option value="12">Dezembro</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                    <button class="btn btn-primary" onclick="carregarComparativoPeriodos()" style="padding: 6px 16px; margin-top: 15px;">üîç Comparar Per√≠odos</button>
                </div>
                
                <div id="comparativo-periodos-content">Carregando...</div>
            </div>

            <!-- Indicadores -->
            <div id="indicadores-section" class="content-card hidden">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2 style="margin: 0;">üéØ Indicadores Financeiros</h2>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn btn-primary" onclick="exportarIndicadoresPDF()" style="padding: 8px 16px; font-size: 13px; background: #e74c3c;">üìù PDF</button>
                        <button class="btn btn-primary" onclick="exportarIndicadoresExcel()" style="padding: 8px 16px; font-size: 13px; background: #27ae60;">üìä Excel</button>
                    </div>
                </div>
                
                <!-- Filtros -->
                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                    <div style="display: flex; gap: 15px; align-items: flex-end; flex-wrap: wrap;">
                        <div>
                            <label style="font-size: 12px; color: #666; display: block; margin-bottom: 4px;">Per√≠odo:</label>
                            <select id="filter-periodo-indicadores" onchange="aplicarFiltroPeriodoIndicadores()" style="padding: 6px; border: 1px solid #ddd; border-radius: 4px; min-width: 150px;">
                                <option value="30">√öltimos 30 dias</option>
                                <option value="90">√öltimos 3 meses</option>
                                <option value="180">√öltimos 6 meses</option>
                                <option value="365">√öltimo ano</option>
                                <option value="custom">Per√≠odo personalizado</option>
                            </select>
                        </div>
                        <div id="filtro-data-inicio-indicadores" style="display: none;">
                            <label style="font-size: 12px; color: #666; display: block; margin-bottom: 4px;">Data Inicial:</label>
                            <input type="date" id="filter-data-inicio-indicadores" onchange="carregarIndicadores()" style="padding: 6px; border: 1px solid #ddd; border-radius: 4px;">
                        </div>
                        <div id="filtro-data-fim-indicadores" style="display: none;">
                            <label style="font-size: 12px; color: #666; display: block; margin-bottom: 4px;">Data Final:</label>
                            <input type="date" id="filter-data-fim-indicadores" onchange="carregarIndicadores()" style="padding: 6px; border: 1px solid #ddd; border-radius: 4px;">
                        </div>
                    </div>
                </div>
                
                <div id="indicadores-content">Carregando...</div>
            </div>

            <!-- Inadimpl√™ncia -->
            <div id="inadimplencia-section" class="content-card hidden">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2 style="margin: 0;">‚ö†Ô∏è Inadimpl√™ncia</h2>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn btn-primary" onclick="exportarInadimplenciaPDF()" style="padding: 8px 16px; font-size: 13px; background: #e74c3c;">üìù PDF</button>
                        <button class="btn btn-primary" onclick="exportarInadimplenciaExcel()" style="padding: 8px 16px; font-size: 13px; background: #27ae60;">üìä Excel</button>
                    </div>
                </div>
                <div id="inadimplencia-content">Carregando...</div>
            </div>

            <!-- Contas Banc√°rias -->
            <div id="contas-bancarias-section" class="content-card hidden">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2 style="margin: 0;">Contas Banc√°rias</h2>
                    <div style="display: flex; gap: 20px; align-items: center;">
                        <div style="text-align: center;">
                            <label style="display: block; font-size: 14px; color: #2c3e50; font-weight: bold; margin-bottom: 8px;">Filtro por Banco</label>
                            <select id="filtro-banco" onchange="filtrarPorBanco()" style="padding: 8px 15px; border: 2px solid #3498db; border-radius: 8px; font-size: 14px; background: white; cursor: pointer;">
                                <option value="">Todos os Bancos</option>
                            </select>
                        </div>
                        <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 15px 25px; border-radius: 12px; box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3); text-align: center; min-width: 200px;">
                            <div style="font-size: 12px; color: rgba(255,255,255,0.9); margin-bottom: 5px; font-weight: 600;">üí∞ SALDO TOTAL</div>
                            <div id="saldo-total-display" style="font-size: 24px; color: white; font-weight: bold;">R$ 0,00</div>
                        </div>
                    </div>
                </div>
                <button class="btn btn-primary" onclick="openModalConta()">‚ûï Nova Conta</button>
                <table id="table-contas">
                    <thead>
                        <tr>
                            <th>Banco</th>
                            <th>Ag√™ncia</th>
                            <th>Conta</th>
                            <th>Saldo Inicial</th>
                            <th>Saldo Atual</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody id="tbody-contas">
                        <tr><td colspan="6" class="loading">Carregando...</td></tr>
                    </tbody>
                </table>
            </div>

            <!-- Categorias -->
            <div id="categorias-section" class="content-card hidden">
                <h2>Categorias</h2>
                <button class="btn btn-primary" onclick="openModalCategoria()">‚ûï Nova Categoria</button>
                
                <!-- Abas de Categorias -->
                <div style="margin: 20px 0; border-bottom: 2px solid #e0e0e0;">
                    <button class="tab-button active" onclick="showCategoriaTab('receita')" id="tab-receita">
                        üí∞ Categorias de Receitas
                    </button>
                    <button class="tab-button" onclick="showCategoriaTab('despesa')" id="tab-despesa">
                        üí∏ Categorias de Despesas
                    </button>
                </div>

                <!-- Tabela de Categorias de Receita -->
                <div id="categorias-receita-container">
                    <div class="table-scroll-container">
                        <table id="table-categorias-receita">
                            <thead>
                                <tr>
                                    <th>Nome</th>
                                    <th>A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody id="tbody-categorias-receita">
                                <tr><td colspan="2" class="loading">Carregando...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Tabela de Categorias de Despesa -->
                <div id="categorias-despesa-container" class="hidden">
                    <div class="table-scroll-container">
                        <table id="table-categorias-despesa">
                            <thead>
                                <tr>
                                    <th>Nome</th>
                                    <th>A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody id="tbody-categorias-despesa">
                                <tr><td colspan="2" class="loading">Carregando...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Clientes -->
            <div id="clientes-section" class="content-card hidden">
                <h2>Clientes</h2>
                <div style="display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap;">
                    <button class="btn btn-primary" onclick="openModalCliente()">‚ûï Novo Cliente</button>
                    <button class="btn" onclick="exportarClientesPDF()" style="background: #e74c3c; color: white;">üìÑ Exportar PDF</button>
                    <button class="btn" onclick="exportarClientesExcel()" style="background: #27ae60; color: white;">üìä Exportar Excel</button>
                </div>
                
                <!-- Tabs de Status -->
                <div style="display: flex; gap: 5px; margin-bottom: 15px; border-bottom: 2px solid #ddd;">
                    <button class="tab-button active" onclick="showClienteTab('ativos')" id="tab-clientes-ativos" style="padding: 10px 20px; border: none; background: #9b59b6; color: white; cursor: pointer; border-radius: 5px 5px 0 0; font-weight: bold;">
                        Ativos
                    </button>
                    <button class="tab-button" onclick="showClienteTab('inativos')" id="tab-clientes-inativos" style="padding: 10px 20px; border: none; background: #bdc3c7; color: #555; cursor: pointer; border-radius: 5px 5px 0 0;">
                        Inativos
                    </button>
                </div>
                
                <div class="table-scroll-container">
                    <table id="table-clientes">
                        <thead>
                            <tr>
                                <th>Raz√£o Social</th>
                                <th>Nome Fantasia</th>
                                <th>CNPJ</th>
                                <th>Cidade</th>
                                <th>Telefone</th>
                                <th id="th-data-inativacao-cliente" style="display: none;">Data Inativa√ß√£o</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="tbody-clientes">
                            <tr><td colspan="7" class="loading">Carregando...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Fornecedores -->
            <div id="fornecedores-section" class="content-card hidden">
                <h2>Fornecedores</h2>
                <div style="display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap;">
                    <button class="btn btn-primary" onclick="openModalFornecedor()">‚ûï Novo Fornecedor</button>
                    <button class="btn" onclick="exportarFornecedoresPDF()" style="background: #e74c3c; color: white;">üìÑ Exportar PDF</button>
                    <button class="btn" onclick="exportarFornecedoresExcel()" style="background: #27ae60; color: white;">üìä Exportar Excel</button>
                </div>
                
                <!-- Tabs de Status -->
                <div style="display: flex; gap: 5px; margin-bottom: 15px; border-bottom: 2px solid #ddd;">
                    <button class="tab-button active" onclick="showFornecedorTab('ativos')" id="tab-fornecedores-ativos" style="padding: 10px 20px; border: none; background: #9b59b6; color: white; cursor: pointer; border-radius: 5px 5px 0 0; font-weight: bold;">
                        Ativos
                    </button>
                    <button class="tab-button" onclick="showFornecedorTab('inativos')" id="tab-fornecedores-inativos" style="padding: 10px 20px; border: none; background: #bdc3c7; color: #555; cursor: pointer; border-radius: 5px 5px 0 0;">
                        Inativos
                    </button>
                </div>
                
                <div class="table-scroll-container">
                    <table id="table-fornecedores">
                        <thead>
                            <tr>
                                <th>Raz√£o Social</th>
                                <th>Nome Fantasia</th>
                                <th>CNPJ</th>
                                <th>Cidade</th>
                                <th>Telefone</th>
                                <th id="th-data-inativacao-fornecedor" style="display: none;">Data Inativa√ß√£o</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="tbody-fornecedores">
                            <tr><td colspan="7" class="loading">Carregando...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Tipos de Sess√£o -->
            <div id="tipos-sessao-section" class="content-card hidden">
                <h2>Tipos de Sess√£o</h2>
                <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                    <button class="btn btn-primary" onclick="openModalTipoSessao()">‚ûï Novo Tipo</button>
                </div>
                <div class="table-scroll-container">
                    <table id="table-tipos-sessao">
                        <thead>
                            <tr>
                                <th>Nome</th>
                                <th>Status</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="tbody-tipos-sessao">
                            <tr><td colspan="3" class="loading">Carregando...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Gerenciamento de Usu√°rios (Admin) -->
            <div id="usuarios-section" class="content-card hidden">
                <h2>üîê Gerenciamento de Usu√°rios</h2>
                <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                    <button class="btn btn-primary" onclick="openModalUsuario()">‚ûï Novo Usu√°rio</button>
                    <button class="btn" onclick="refreshUsuarios()" style="background: #3498db; color: white;">üîÑ Atualizar</button>
                </div>
                
                <!-- Tabs -->
                <div style="display: flex; gap: 5px; margin-bottom: 15px; border-bottom: 2px solid #ddd;">
                    <button class="tab-button active" onclick="showUsuariosTab('ativos')" id="tab-usuarios-ativos" style="padding: 10px 20px; border: none; background: #27ae60; color: white; cursor: pointer; border-radius: 5px 5px 0 0; font-weight: bold;">
                        ‚úÖ Ativos
                    </button>
                    <button class="tab-button" onclick="showUsuariosTab('inativos')" id="tab-usuarios-inativos" style="padding: 10px 20px; border: none; background: #bdc3c7; color: #555; cursor: pointer; border-radius: 5px 5px 0 0;">
                        ‚ùå Inativos
                    </button>
                    <button class="tab-button" onclick="showUsuariosTab('todos')" id="tab-usuarios-todos" style="padding: 10px 20px; border: none; background: #bdc3c7; color: #555; cursor: pointer; border-radius: 5px 5px 0 0;">
                        üìã Todos
                    </button>
                </div>
                
                <div class="table-scroll-container">
                    <table id="table-usuarios">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Username</th>
                                <th>Nome Completo</th>
                                <th>E-mail</th>
                                <th>Tipo</th>
                                <th>Cliente Associado</th>
                                <th>Status</th>
                                <th>√öltima Sess√£o</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="tbody-usuarios">
                            <tr><td colspan="9" class="loading">Carregando...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Permiss√µes (Admin) -->
            <div id="permissoes-section" class="content-card hidden">
                <h2>üîê Gerenciamento de Permiss√µes</h2>
                <div style="margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-left: 4px solid #3498db; border-radius: 5px;">
                    <p style="margin: 0; color: #555;">
                        <strong>‚ÑπÔ∏è Informa√ß√£o:</strong> Selecione um usu√°rio para visualizar e editar suas permiss√µes.
                    </p>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <label for="select-usuario-permissao" style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">
                        Selecionar Usu√°rio:
                    </label>
                    <select id="select-usuario-permissao" onchange="loadUsuarioPermissoes()" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 5px; font-size: 14px;">
                        <option value="">-- Selecione um usu√°rio --</option>
                    </select>
                </div>
                
                <div id="permissoes-usuario-container" style="display: none;">
                    <h3 style="margin-bottom: 15px; color: #2c3e50;">Permiss√µes do Usu√°rio</h3>
                    <div id="permissoes-list" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 15px;">
                        <!-- Permiss√µes ser√£o carregadas via JavaScript -->
                    </div>
                    <div style="margin-top: 20px; display: flex; gap: 10px;">
                        <button class="btn btn-primary" onclick="salvarPermissoes()">üíæ Salvar Altera√ß√µes</button>
                        <button class="btn" onclick="cancelarEdicaoPermissoes()" style="background: #95a5a6; color: white;">‚ùå Cancelar</button>
                    </div>
                </div>
            </div>

            <!-- Logs de Acesso (Admin) -->
            <div id="logs-section" class="content-card hidden">
                <h2>üìã Logs de Acesso</h2>
                <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                    <button class="btn" onclick="refreshLogs()" style="background: #3498db; color: white;">üîÑ Atualizar</button>
                    <input type="date" id="filter-log-data-inicio" onchange="filterLogs()" style="padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                    <input type="date" id="filter-log-data-fim" onchange="filterLogs()" style="padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                    <select id="filter-log-usuario" onchange="filterLogs()" style="padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                        <option value="">Todos os usu√°rios</option>
                    </select>
                </div>
                
                <div class="table-scroll-container">
                    <table id="table-logs">
                        <thead>
                            <tr>
                                <th>Data/Hora</th>
                                <th>Usu√°rio</th>
                                <th>Tipo</th>
                                <th>A√ß√£o</th>
                                <th>IP</th>
                                <th>Navegador</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="tbody-logs">
                            <tr><td colspan="7" class="loading">Carregando...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Contratos e Sess√µes -->
            <div id="contratos-section" class="content-card hidden">
                <h2>Contratos e Sess√µes</h2>
                
                <!-- Tabs -->
                <div style="display: flex; gap: 5px; margin-bottom: 15px; border-bottom: 2px solid #ddd;">
                    <button class="tab-button active" onclick="showContratoTab('contratos')" id="tab-contratos" style="padding: 10px 20px; border: none; background: #9b59b6; color: white; cursor: pointer; border-radius: 5px 5px 0 0; font-weight: bold;">
                        Contratos
                    </button>
                    <button class="tab-button" onclick="showContratoTab('sessoes')" id="tab-sessoes" style="padding: 10px 20px; border: none; background: #bdc3c7; color: #555; cursor: pointer; border-radius: 5px 5px 0 0;">
                        Sess√µes
                    </button>
                    <button class="tab-button" onclick="showContratoTab('comissoes')" id="tab-comissoes" style="padding: 10px 20px; border: none; background: #bdc3c7; color: #555; cursor: pointer; border-radius: 5px 5px 0 0;">
                        Comiss√µes
                    </button>
                    <button class="tab-button" onclick="showContratoTab('equipe')" id="tab-equipe" style="padding: 10px 20px; border: none; background: #bdc3c7; color: #555; cursor: pointer; border-radius: 5px 5px 0 0;">
                        Equipe
                    </button>
                </div>

                <!-- Tab Contratos -->
                <div id="tab-content-contratos">
                    <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                        <button class="btn btn-primary" onclick="openModalContrato()">‚ûï Novo Contrato</button>
                        <button class="btn" onclick="exportarContratosPDF()" style="background: #e74c3c; color: white;">üìÑ Exportar PDF</button>
                    </div>
                    <div class="table-scroll-container">
                        <table id="table-contratos">
                            <thead>
                                <tr>
                                    <th>N√∫mero</th>
                                    <th>Cliente</th>
                                    <th>Valor Total</th>
                                    <th>Data Assinatura</th>
                                    <th>Status</th>
                                    <th>A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody id="tbody-contratos">
                                <tr><td colspan="6" class="loading">Carregando...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Tab Sess√µes -->
                <div id="tab-content-sessoes" style="display: none;">
                    <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                        <button class="btn btn-primary" onclick="openModalSessao()">‚ûï Nova Sess√£o</button>
                    </div>
                    <div class="table-scroll-container">
                        <table id="table-sessoes">
                            <thead>
                                <tr>
                                    <th>Contrato</th>
                                    <th>T√≠tulo</th>
                                    <th>Data Sess√£o</th>
                                    <th>Dura√ß√£o</th>
                                    <th>Cliente</th>
                                    <th>Valor</th>
                                    <th>A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody id="tbody-sessoes">
                                <tr><td colspan="7" class="loading">Carregando...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Tab Comiss√µes -->
                <div id="tab-content-comissoes" style="display: none;">
                    <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                        <button class="btn btn-primary" onclick="openModalComissao()">‚ûï Nova Comiss√£o</button>
                    </div>
                    <div class="table-scroll-container">
                        <table id="table-comissoes">
                            <thead>
                                <tr>
                                    <th>Contrato</th>
                                    <th>Cliente</th>
                                    <th>Tipo</th>
                                    <th>Valor</th>
                                    <th>Percentual</th>
                                    <th>A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody id="tbody-comissoes">
                                <tr><td colspan="6" class="loading">Carregando...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Tab Equipe -->
                <div id="tab-content-equipe" style="display: none;">
                    <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                        <button class="btn btn-primary" onclick="openModalSessaoEquipe()">‚ûï Adicionar Membro</button>
                    </div>
                    <div class="table-scroll-container">
                        <table id="table-sessao-equipe">
                            <thead>
                                <tr>
                                    <th>Sess√£o</th>
                                    <th>Membro</th>
                                    <th>Fun√ß√£o</th>
                                    <th>Observa√ß√µes</th>
                                    <th>A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody id="tbody-sessao-equipe">
                                <tr><td colspan="5" class="loading">Carregando...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Agenda de Fotografia -->
            <div id="agenda-fotografia-section" class="content-card hidden">
                <h2>Agenda de Fotografia</h2>
                <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                    <button class="btn btn-primary" onclick="openModalAgenda()">‚ûï Novo Agendamento</button>
                    <button class="btn" onclick="visualizarCalendario()" style="background: #3498db; color: white;">üìÖ Ver Calend√°rio</button>
                </div>
                <div class="table-scroll-container">
                    <table id="table-agenda">
                        <thead>
                            <tr>
                                <th>Data/Hora</th>
                                <th>Cliente</th>
                                <th>Local</th>
                                <th>Tipo</th>
                                <th>Status</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="tbody-agenda">
                            <tr><td colspan="6" class="loading">Carregando...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Gest√£o de Estoque -->
            <div id="gestao-estoque-section" class="content-card hidden">
                <h2>Gest√£o de Estoque</h2>
                
                <!-- Tabs -->
                <div style="display: flex; gap: 5px; margin-bottom: 15px; border-bottom: 2px solid #ddd;">
                    <button class="tab-button active" onclick="showEstoqueTab('produtos')" id="tab-produtos" style="padding: 10px 20px; border: none; background: #9b59b6; color: white; cursor: pointer; border-radius: 5px 5px 0 0; font-weight: bold;">
                        Produtos
                    </button>
                    <button class="tab-button" onclick="showEstoqueTab('movimentacoes')" id="tab-movimentacoes" style="padding: 10px 20px; border: none; background: #bdc3c7; color: #555; cursor: pointer; border-radius: 5px 5px 0 0;">
                        Movimenta√ß√µes
                    </button>
                </div>

                <!-- Tab Produtos -->
                <div id="tab-content-produtos">
                    <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                        <button class="btn btn-primary" onclick="openModalProduto()">‚ûï Novo Produto</button>
                        <button class="btn" onclick="exportarEstoquePDF()" style="background: #e74c3c; color: white;">üìÑ Exportar PDF</button>
                    </div>
                    <div class="table-scroll-container">
                        <table id="table-produtos">
                            <thead>
                                <tr>
                                    <th>Nome</th>
                                    <th>C√≥digo</th>
                                    <th>Quantidade</th>
                                    <th>Unidade</th>
                                    <th>Valor Unit√°rio</th>
                                    <th>A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody id="tbody-produtos">
                                <tr><td colspan="6" class="loading">Carregando...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Tab Movimenta√ß√µes -->
                <div id="tab-content-movimentacoes" style="display: none;">
                    <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                        <button class="btn btn-primary" onclick="openModalMovimentacao()">‚ûï Nova Movimenta√ß√£o</button>
                    </div>
                    <div class="table-scroll-container">
                        <table id="table-movimentacoes">
                            <thead>
                                <tr>
                                    <th>Data</th>
                                    <th>Produto</th>
                                    <th>Tipo</th>
                                    <th>Quantidade</th>
                                    <th>Observa√ß√µes</th>
                                    <th>A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody id="tbody-movimentacoes">
                                <tr><td colspan="6" class="loading">Carregando...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Kits de Equipamentos -->
            <div id="kits-equipamentos-section" class="content-card hidden">
                <h2>Kits de Equipamentos</h2>
                <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                    <button class="btn btn-primary" onclick="openModalKit()">‚ûï Novo Kit</button>
                </div>
                <div class="table-scroll-container">
                    <table id="table-kits">
                        <thead>
                            <tr>
                                <th>Nome</th>
                                <th>Descri√ß√£o</th>
                                <th>Itens</th>
                                <th>Valor Total</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="tbody-kits">
                            <tr><td colspan="5" class="loading">Carregando...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Tags de Trabalho -->
            <div id="tags-trabalho-section" class="content-card hidden">
                <h2>Tags de Trabalho</h2>
                <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                    <button class="btn btn-primary" onclick="openModalTag()">‚ûï Nova Tag</button>
                </div>
                <div class="table-scroll-container">
                    <table id="table-tags">
                        <thead>
                            <tr>
                                <th>Nome</th>
                                <th>Cor</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="tbody-tags">
                            <tr><td colspan="3" class="loading">Carregando...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Templates de Equipe -->
            <div id="templates-equipe-section" class="content-card hidden">
                <h2>Templates de Equipe</h2>
                <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                    <button class="btn btn-primary" onclick="openModalTemplate()">‚ûï Novo Template</button>
                </div>
                <div class="table-scroll-container">
                    <table id="table-templates">
                        <thead>
                            <tr>
                                <th>Nome</th>
                                <th>Descri√ß√£o</th>
                                <th>Membros</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="tbody-templates">
                            <tr><td colspan="4" class="loading">Carregando...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals (continua√ß√£o no pr√≥ximo arquivo devido ao limite de tamanho) -->
    
    <!-- Modal Visualizar Motivo Inativa√ß√£o -->
    <div id="modal-motivo-inativacao" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; justify-content: center; align-items: center;">
        <div style="background: white; padding: 30px; border-radius: 12px; max-width: 600px; width: 90%; box-shadow: 0 10px 40px rgba(0,0,0,0.3);">
            <div style="display: flex; align-items: center; margin-bottom: 20px;">
                <span style="font-size: 48px; margin-right: 15px;">‚ÑπÔ∏è</span>
                <h2 style="margin: 0; color: #34495e;">Informa√ß√µes da Inativa√ß√£o</h2>
            </div>
            
            <div style="background: #ecf0f1; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <div style="margin-bottom: 15px;">
                    <label style="font-weight: bold; color: #7f8c8d; font-size: 12px; text-transform: uppercase;">Nome:</label>
                    <p id="motivo-nome" style="margin: 5px 0 0 0; font-size: 16px; color: #2c3e50;"></p>
                </div>
                
                <div style="margin-bottom: 15px;">
                    <label style="font-weight: bold; color: #7f8c8d; font-size: 12px; text-transform: uppercase;">Data de Inativa√ß√£o:</label>
                    <p id="motivo-data" style="margin: 5px 0 0 0; font-size: 16px; color: #2c3e50;"></p>
                </div>
                
                <div>
                    <label style="font-weight: bold; color: #7f8c8d; font-size: 12px; text-transform: uppercase;">Motivo:</label>
                    <p id="motivo-texto" style="margin: 5px 0 0 0; font-size: 16px; color: #2c3e50; line-height: 1.6; white-space: pre-wrap;"></p>
                </div>
            </div>
            
            <div style="display: flex; justify-content: flex-end;">
                <button onclick="closeModalMotivoInativacao()" style="padding: 12px 30px; border: none; background: #3498db; color: white; border-radius: 5px; cursor: pointer; font-weight: bold; font-size: 14px;">
                    Fechar
                </button>
            </div>
        </div>
    </div>
    
    <!-- Modal Inativar Cliente -->
    <div id="modal-inativar-cliente" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; justify-content: center; align-items: center;">
        <div style="background: white; padding: 30px; border-radius: 12px; max-width: 500px; width: 90%; box-shadow: 0 10px 40px rgba(0,0,0,0.3);">
            <h2 style="margin-top: 0; color: #e74c3c;">‚õî Inativar Cliente</h2>
            
            <p style="margin-bottom: 20px; color: #555;">
                Cliente: <strong id="inativar-cliente-nome"></strong>
            </p>
            
            <div class="form-group">
                <label>Motivo da Inativa√ß√£o: <span style="color: red;">*</span></label>
                <textarea id="inativar-cliente-motivo" rows="4" required 
                    style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 5px; font-family: inherit; resize: vertical;"
                    placeholder="Descreva o motivo da inativa√ß√£o..."></textarea>
            </div>
            
            <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                <button onclick="closeModalInativarCliente()" style="padding: 10px 20px; border: 2px solid #95a5a6; background: white; color: #555; border-radius: 5px; cursor: pointer; font-weight: bold;">
                    Cancelar
                </button>
                <button onclick="confirmarInativarCliente()" style="padding: 10px 20px; border: none; background: #e74c3c; color: white; border-radius: 5px; cursor: pointer; font-weight: bold;">
                    Inativar
                </button>
            </div>
        </div>
    </div>
    
    <!-- Modal Inativar Fornecedor -->
    <div id="modal-inativar-fornecedor" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; justify-content: center; align-items: center;">
        <div style="background: white; padding: 30px; border-radius: 12px; max-width: 500px; width: 90%; box-shadow: 0 10px 40px rgba(0,0,0,0.3);">
            <h2 style="margin-top: 0; color: #e74c3c;">‚õî Inativar Fornecedor</h2>
            
            <p style="margin-bottom: 20px; color: #555;">
                Fornecedor: <strong id="inativar-fornecedor-nome"></strong>
            </p>
            
            <div class="form-group">
                <label>Motivo da Inativa√ß√£o: <span style="color: red;">*</span></label>
                <textarea id="inativar-fornecedor-motivo" rows="4" required 
                    style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 5px; font-family: inherit; resize: vertical;"
                    placeholder="Descreva o motivo da inativa√ß√£o..."></textarea>
            </div>
            
            <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                <button onclick="closeModalInativarFornecedor()" style="padding: 10px 20px; border: 2px solid #95a5a6; background: white; color: #555; border-radius: 5px; cursor: pointer; font-weight: bold;">
                    Cancelar
                </button>
                <button onclick="confirmarInativarFornecedor()" style="padding: 10px 20px; border: none; background: #e74c3c; color: white; border-radius: 5px; cursor: pointer; font-weight: bold;">
                    Inativar
                </button>
            </div>
        </div>
    </div>
    
    <!-- Modal Transfer√™ncia entre Contas -->
    <div id="modal-transferencia" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; justify-content: center; align-items: center;">
        <div style="background: white; padding: 30px; border-radius: 12px; max-width: 500px; width: 90%; box-shadow: 0 10px 40px rgba(0,0,0,0.3);">
            <h2 style="margin-top: 0; color: #9b59b6;">üîÑ Transfer√™ncia entre Contas</h2>
            
            <div class="form-group">
                <label>Conta de Origem:</label>
                <select id="transferencia-origem" required style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 5px;">
                    <option value="">Selecione a conta de origem</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>Conta de Destino:</label>
                <select id="transferencia-destino" required style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 5px;">
                    <option value="">Selecione a conta de destino</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>Valor:</label>
                <input type="number" id="transferencia-valor" step="0.01" min="0.01" required placeholder="0.00" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 5px;">
            </div>
            
            <div class="form-group">
                <label>Data da Transfer√™ncia:</label>
                <input type="date" id="transferencia-data" required style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 5px;">
            </div>
            
            <div class="form-group">
                <label>Observa√ß√µes (opcional):</label>
                <textarea id="transferencia-observacoes" rows="3" placeholder="Informa√ß√µes adicionais sobre a transfer√™ncia..." style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 5px; resize: vertical;"></textarea>
            </div>
            
            <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                <button class="btn btn-secondary" onclick="closeModalTransferencia()">Cancelar</button>
                <button class="btn btn-success" onclick="salvarTransferencia()" style="background: #9b59b6;">üîÑ Transferir</button>
            </div>
        </div>
    </div>
    
    <!-- Modal Tipo de Sess√£o -->
    <div id="modal-tipo-sessao" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; justify-content: center; align-items: center;">
        <div style="background: white; padding: 30px; border-radius: 12px; max-width: 500px; width: 90%; box-shadow: 0 10px 40px rgba(0,0,0,0.3);">
            <h2 style="margin-top: 0; color: #9b59b6;">üì∏ Tipo de Sess√£o</h2>
            
            <input type="hidden" id="tipo-sessao-id">
            
            <div class="form-group">
                <label>Nome do Tipo:</label>
                <input type="text" id="tipo-sessao-nome" required placeholder="Ex: Ensaio Newborn" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 5px;">
            </div>
            
            <div class="form-group">
                <label>
                    <input type="checkbox" id="tipo-sessao-ativa" checked>
                    Tipo Ativo
                </label>
            </div>
            
            <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                <button class="btn btn-secondary" onclick="closeModalTipoSessao()">Cancelar</button>
                <button class="btn btn-success" onclick="salvarTipoSessao()">üíæ Salvar</button>
            </div>
        </div>
    </div>

    <!-- Modal Contrato -->
    <div id="modal-contrato" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; justify-content: center; align-items: center; overflow-y: auto;">
        <div style="background: white; padding: 30px; border-radius: 12px; max-width: 700px; width: 90%; box-shadow: 0 10px 40px rgba(0,0,0,0.3); margin: 20px;">
            <h2 style="margin-top: 0; color: #9b59b6;">üìÑ Contrato</h2>
            
            <input type="hidden" id="contrato-id">
            
            <div class="form-group">
                <label>*N√∫mero do Contrato: <span style="font-size: 12px; color: #666;">(Gerado automaticamente)</span></label>
                <input type="text" id="contrato-numero" required readonly placeholder="Aguardando..." style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 5px; background-color: #f5f5f5; cursor: not-allowed;">
            </div>
            
            <div class="form-group">
                <label>Cliente:</label>
                <select id="contrato-cliente-id" required style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 5px;">
                    <option value="">Selecione o cliente</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>*Descri√ß√£o:</label>
                <textarea id="contrato-descricao" required rows="3" placeholder="Descreva o contrato..." style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 5px;"></textarea>
            </div>
            
            <div class="form-group">
                <label>*Valor Total:</label>
                <input type="number" id="contrato-valor-total" step="0.01" min="0" required placeholder="0.00" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 5px;">
            </div>
            
            <div class="form-row" style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                <div class="form-group">
                    <label>*Data In√≠cio:</label>
                    <input type="date" id="contrato-data-inicio" required style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 5px;">
                </div>
                <div class="form-group">
                    <label>Data Fim:</label>
                    <input type="date" id="contrato-data-fim" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 5px;">
                </div>
            </div>
            
            <div class="form-group">
                <label>Status:</label>
                <select id="contrato-status" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 5px;">
                    <option value="ativo">Ativo</option>
                    <option value="concluido">Conclu√≠do</option>
                    <option value="cancelado">Cancelado</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>Observa√ß√µes:</label>
                <textarea id="contrato-observacoes" rows="3" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 5px;"></textarea>
            </div>
            
            <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                <button class="btn btn-secondary" onclick="closeModalContrato()">Cancelar</button>
                <button class="btn btn-success" onclick="salvarContrato()">üíæ Salvar</button>
            </div>
        </div>
    </div>

    <!-- Modal Sess√£o -->
    <div id="modal-sessao" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; justify-content: center; align-items: center;">
        <div style="background: white; padding: 30px; border-radius: 12px; max-width: 600px; width: 90%; box-shadow: 0 10px 40px rgba(0,0,0,0.3);">
            <h2 style="margin-top: 0; color: #9b59b6;">üì∏ Sess√£o Fotogr√°fica</h2>
            
            <input type="hidden" id="sessao-id">
            
            <div class="form-group">
                <label>T√≠tulo:</label>
                <input type="text" id="sessao-titulo" required style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 5px;" placeholder="Ex: Ensaio Gestante - Maria Silva">
            </div>
            
            <div class="form-group">
                <label>Data da Sess√£o:</label>
                <input type="date" id="sessao-data-sessao" required style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 5px;">
            </div>
            
            <div class="form-group">
                <label>Dura√ß√£o (minutos):</label>
                <input type="number" id="sessao-duracao" min="0" step="15" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 5px;" placeholder="Ex: 60">
            </div>
            
            <div class="form-group">
                <label>Tipo de Sess√£o:</label>
                <select id="sessao-tipo-sessao-id" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 5px;">
                    <option value="">Selecione o tipo (opcional)</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>Contrato:</label>
                <select id="sessao-contrato-id" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 5px;">
                    <option value="">Selecione o contrato (opcional)</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>Cliente:</label>
                <select id="sessao-cliente-id" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 5px;">
                    <option value="">Selecione o cliente (opcional)</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>Valor (R$):</label>
                <input type="number" id="sessao-valor" min="0" step="0.01" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 5px;" placeholder="0,00">
            </div>
            
            <div class="form-group">
                <label>Observa√ß√µes:</label>
                <textarea id="sessao-observacoes" rows="3" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 5px;" placeholder="Observa√ß√µes adicionais..."></textarea>
            </div>
            
            <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                <button class="btn btn-secondary" onclick="closeModalSessao()">Cancelar</button>
                <button class="btn btn-success" onclick="salvarSessao()">üíæ Salvar</button>
            </div>
        </div>
    </div>

    <!-- Modal Agenda -->
    <div id="modal-agenda" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; justify-content: center; align-items: center;">
        <div style="background: white; padding: 30px; border-radius: 12px; max-width: 600px; width: 90%; box-shadow: 0 10px 40px rgba(0,0,0,0.3);">
            <h2 style="margin-top: 0; color: #9b59b6;">üìÖ Agendamento</h2>
            
            <input type="hidden" id="agenda-id">
            
            <div class="form-group">
                <label>Cliente:</label>
                <select id="agenda-cliente-id" required style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 5px;">
                    <option value="">Selecione o cliente</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>Data e Hora:</label>
                <input type="datetime-local" id="agenda-data-hora" required style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 5px;">
            </div>
            
            <div class="form-group">
                <label>Local:</label>
                <input type="text" id="agenda-local" placeholder="Ex: Est√∫dio, Externa, Casa do cliente" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 5px;">
            </div>
            
            <div class="form-group">
                <label>Tipo:</label>
                <input type="text" id="agenda-tipo" placeholder="Ex: Ensaio Fam√≠lia" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 5px;">
            </div>
            
            <div class="form-group">
                <label>Status:</label>
                <select id="agenda-status" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 5px;">
                    <option value="confirmado">Confirmado</option>
                    <option value="pendente">Pendente</option>
                    <option value="cancelado">Cancelado</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>Observa√ß√µes:</label>
                <textarea id="agenda-observacoes" rows="3" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 5px;"></textarea>
            </div>
            
            <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                <button class="btn btn-secondary" onclick="closeModalAgenda()">Cancelar</button>
                <button class="btn btn-success" onclick="salvarAgenda()">üíæ Salvar</button>
            </div>
        </div>
    </div>

    <!-- Modal Produto -->
    <div id="modal-produto" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; justify-content: center; align-items: center;">
        <div style="background: white; padding: 30px; border-radius: 12px; max-width: 600px; width: 90%; box-shadow: 0 10px 40px rgba(0,0,0,0.3);">
            <h2 style="margin-top: 0; color: #9b59b6;">üì¶ Produto</h2>
            
            <input type="hidden" id="produto-id">
            
            <div class="form-group">
                <label>Nome:</label>
                <input type="text" id="produto-nome" required placeholder="Ex: Papel Fotogr√°fico A4" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 5px;">
            </div>
            
            <div class="form-group">
                <label>C√≥digo:</label>
                <input type="text" id="produto-codigo" placeholder="Ex: PF-A4-001" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 5px;">
            </div>
            
            <div class="form-group">
                <label>Quantidade:</label>
                <input type="number" id="produto-quantidade" min="0" step="1" required placeholder="0" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 5px;">
            </div>
            
            <div class="form-group">
                <label>Unidade:</label>
                <select id="produto-unidade" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 5px;">
                    <option value="un">Unidade</option>
                    <option value="cx">Caixa</option>
                    <option value="pc">Pacote</option>
                    <option value="kg">Quilograma</option>
                    <option value="l">Litro</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>Valor Unit√°rio:</label>
                <input type="number" id="produto-valor-unitario" step="0.01" min="0" placeholder="0.00" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 5px;">
            </div>
            
            <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                <button class="btn btn-secondary" onclick="closeModalProduto()">Cancelar</button>
                <button class="btn btn-success" onclick="salvarProduto()">üíæ Salvar</button>
            </div>
        </div>
    </div>

    <!-- Modal Movimenta√ß√£o -->
    <div id="modal-movimentacao" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; justify-content: center; align-items: center;">
        <div style="background: white; padding: 30px; border-radius: 12px; max-width: 600px; width: 90%; box-shadow: 0 10px 40px rgba(0,0,0,0.3);">
            <h2 style="margin-top: 0; color: #9b59b6;">üìã Movimenta√ß√£o de Estoque</h2>
            
            <input type="hidden" id="movimentacao-id">
            
            <div class="form-group">
                <label>Produto:</label>
                <select id="movimentacao-produto-id" required style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 5px;">
                    <option value="">Selecione o produto</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>Tipo:</label>
                <select id="movimentacao-tipo" required style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 5px;">
                    <option value="entrada">Entrada</option>
                    <option value="saida">Sa√≠da</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>Quantidade:</label>
                <input type="number" id="movimentacao-quantidade" min="1" step="1" required placeholder="0" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 5px;">
            </div>
            
            <div class="form-group">
                <label>Data:</label>
                <input type="date" id="movimentacao-data" required style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 5px;">
            </div>
            
            <div class="form-group">
                <label>Observa√ß√µes:</label>
                <textarea id="movimentacao-observacoes" rows="3" placeholder="Motivo da movimenta√ß√£o..." style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 5px;"></textarea>
            </div>
            
            <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                <button class="btn btn-secondary" onclick="closeModalMovimentacao()">Cancelar</button>
                <button class="btn btn-success" onclick="salvarMovimentacao()">üíæ Salvar</button>
            </div>
        </div>
    </div>

    <!-- Modal Kit -->
    <div id="modal-kit" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; justify-content: center; align-items: center;">
        <div style="background: white; padding: 30px; border-radius: 12px; max-width: 600px; width: 90%; box-shadow: 0 10px 40px rgba(0,0,0,0.3);">
            <h2 style="margin-top: 0; color: #9b59b6;">üéí Kit de Equipamentos</h2>
            
            <input type="hidden" id="kit-id">
            
            <div class="form-group">
                <label>Nome do Kit:</label>
                <input type="text" id="kit-nome" required placeholder="Ex: Kit Ensaio Externo" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 5px;">
            </div>
            
            <div class="form-group">
                <label>Descri√ß√£o:</label>
                <textarea id="kit-descricao" rows="3" placeholder="Descri√ß√£o dos itens inclu√≠dos no kit..." style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 5px;"></textarea>
            </div>
            
            <div class="form-group">
                <label>Itens (um por linha):</label>
                <textarea id="kit-itens" rows="5" placeholder="C√¢mera Canon 5D&#10;Lente 50mm&#10;Flash Speedlite&#10;Trip√©" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 5px;"></textarea>
            </div>
            
            <div class="form-group">
                <label>Valor Total:</label>
                <input type="number" id="kit-valor-total" step="0.01" min="0" placeholder="0.00" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 5px;">
            </div>
            
            <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                <button class="btn btn-secondary" onclick="closeModalKit()">Cancelar</button>
                <button class="btn btn-success" onclick="salvarKit()">üíæ Salvar</button>
            </div>
        </div>
    </div>
    
    <!-- Modal Comiss√£o -->
    <div id="modal-comissao" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; justify-content: center; align-items: center;">
        <div style="background: white; padding: 30px; border-radius: 12px; max-width: 600px; width: 90%; box-shadow: 0 10px 40px rgba(0,0,0,0.3);">
            <h2 style="margin-top: 0; color: #9b59b6;">üí∞ Comiss√£o</h2>
            
            <input type="hidden" id="comissao-id">
            
            <div class="form-group">
                <label>Contrato:</label>
                <select id="comissao-contrato-id" required style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 5px;">
                    <option value="">Selecione o contrato</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>Tipo:</label>
                <select id="comissao-tipo" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 5px;">
                    <option value="percentual">Percentual</option>
                    <option value="fixo">Valor Fixo</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>Valor:</label>
                <input type="number" id="comissao-valor" step="0.01" min="0" placeholder="0.00" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 5px;">
            </div>
            
            <div class="form-group">
                <label>Percentual (%):</label>
                <input type="number" id="comissao-percentual" step="0.01" min="0" max="100" placeholder="0.00" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 5px;">
            </div>
            
            <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                <button class="btn btn-secondary" onclick="closeModalComissao()">Cancelar</button>
                <button class="btn btn-success" onclick="salvarComissao()">üíæ Salvar</button>
            </div>
        </div>
    </div>

    <!-- Modal Sess√£o Equipe -->
    <div id="modal-sessao-equipe" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; justify-content: center; align-items: center;">
        <div style="background: white; padding: 30px; border-radius: 12px; max-width: 600px; width: 90%; box-shadow: 0 10px 40px rgba(0,0,0,0.3);">
            <h2 style="margin-top: 0; color: #9b59b6;">üë• Membro da Equipe</h2>
            
            <input type="hidden" id="sessao-equipe-id">
            
            <div class="form-group">
                <label>Sess√£o:</label>
                <select id="sessao-equipe-sessao-id" required style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 5px;">
                    <option value="">Selecione a sess√£o</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>Membro:</label>
                <input type="text" id="sessao-equipe-membro" required placeholder="Nome do membro" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 5px;">
            </div>
            
            <div class="form-group">
                <label>Fun√ß√£o:</label>
                <input type="text" id="sessao-equipe-funcao" placeholder="Ex: Fot√≥grafo, Assistente" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 5px;">
            </div>
            
            <div class="form-group">
                <label>Observa√ß√µes:</label>
                <textarea id="sessao-equipe-observacoes" rows="3" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 5px;"></textarea>
            </div>
            
            <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                <button class="btn btn-secondary" onclick="closeModalSessaoEquipe()">Cancelar</button>
                <button class="btn btn-success" onclick="salvarSessaoEquipe()">üíæ Salvar</button>
            </div>
        </div>
    </div>

    <!-- Modal Tag -->
    <div id="modal-tag" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; justify-content: center; align-items: center;">
        <div style="background: white; padding: 30px; border-radius: 12px; max-width: 500px; width: 90%; box-shadow: 0 10px 40px rgba(0,0,0,0.3);">
            <h2 style="margin-top: 0; color: #9b59b6;">üè∑Ô∏è Tag de Trabalho</h2>
            
            <input type="hidden" id="tag-id">
            
            <div class="form-group">
                <label>Nome:</label>
                <input type="text" id="tag-nome" required placeholder="Ex: Urgente, Revis√£o" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 5px;">
            </div>
            
            <div class="form-group">
                <label>Cor:</label>
                <input type="color" id="tag-cor" value="#9b59b6" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 5px; height: 50px;">
            </div>
            
            <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                <button class="btn btn-secondary" onclick="closeModalTag()">Cancelar</button>
                <button class="btn btn-success" onclick="salvarTag()">üíæ Salvar</button>
            </div>
        </div>
    </div>

    <!-- Modal Template -->
    <div id="modal-template" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; justify-content: center; align-items: center;">
        <div style="background: white; padding: 30px; border-radius: 12px; max-width: 600px; width: 90%; box-shadow: 0 10px 40px rgba(0,0,0,0.3);">
            <h2 style="margin-top: 0; color: #9b59b6;">üë• Template de Equipe</h2>
            
            <input type="hidden" id="template-id">
            
            <div class="form-group">
                <label>Nome do Template:</label>
                <input type="text" id="template-nome" required placeholder="Ex: Equipe Casamento Grande" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 5px;">
            </div>
            
            <div class="form-group">
                <label>Descri√ß√£o:</label>
                <textarea id="template-descricao" rows="3" placeholder="Descri√ß√£o do template..." style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 5px;"></textarea>
            </div>
            
            <div class="form-group">
                <label>Membros (um por linha):</label>
                <textarea id="template-membros" rows="5" placeholder="Fot√≥grafo Principal&#10;Fot√≥grafo Assistente&#10;Videomaker&#10;Assistente Geral" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 5px;"></textarea>
            </div>
            
            <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                <button class="btn btn-secondary" onclick="closeModalTemplate()">Cancelar</button>
                <button class="btn btn-success" onclick="salvarTemplate()">üíæ Salvar</button>
            </div>
        </div>
    </div>
    
    <script>
        // ====================================
        // HELPER CSRF - INCLUIR TOKEN EM TODAS AS REQUISI√á√ïES
        // ====================================
        
        // Obter token CSRF do meta tag
        function getCSRFToken() {
            const meta = document.querySelector('meta[name="csrf-token"]');
            return meta ? meta.content : '';
        }
        
        // Wrapper para fetch com CSRF autom√°tico
        async function fetchWithCSRF(url, options = {}) {
            const csrfToken = getCSRFToken();
            
            // Configurar headers padr√£o
            const defaultHeaders = {
                'Content-Type': 'application/json'
            };
            
            // Adicionar CSRF token se m√©todo n√£o for GET
            if (!options.method || options.method.toUpperCase() !== 'GET') {
                defaultHeaders['X-CSRFToken'] = csrfToken;
            }
            
            // Mesclar headers
            options.headers = {
                ...defaultHeaders,
                ...options.headers
            };
            
            // Garantir credentials
            if (!options.credentials) {
                options.credentials = 'include';
            }
            
            return fetch(url, options);
        }
        
        // ====================================
        // INTERCEPTADOR GLOBAL DE FETCH - AUTO CSRF
        // ====================================
        
        // Salvar fetch original
        const originalFetch = window.fetch;
        
        // Substituir fetch global para incluir CSRF automaticamente
        window.fetch = function(url, options = {}) {
            // Se for requisi√ß√£o para API interna (n√£o GET), adicionar CSRF
            if (typeof url === 'string' && url.startsWith('/api')) {
                const method = options.method || 'GET';
                if (method.toUpperCase() !== 'GET') {
                    const csrfToken = getCSRFToken();
                    
                    // Inicializar headers como objeto simples se n√£o existir
                    if (!options.headers) {
                        options.headers = {};
                    }
                    
                    // Se for Headers object, converter para objeto simples
                    if (options.headers instanceof Headers) {
                        const headersObj = {};
                        options.headers.forEach((value, key) => {
                            headersObj[key] = value;
                        });
                        options.headers = headersObj;
                    }
                    
                    // Adicionar CSRF token se n√£o existir
                    if (!options.headers['X-CSRFToken'] && csrfToken) {
                        options.headers['X-CSRFToken'] = csrfToken;
                    }
                }
                
                // Garantir credentials
                if (!options.credentials) {
                    options.credentials = 'include';
                }
            }
            
            return originalFetch(url, options);
        };
        
        // ====================================
        // GERENCIAMENTO DE USU√ÅRIOS (ADMIN)
        // ====================================
        
        let currentUsuarioFilter = 'ativos';
        
        // Carregar usu√°rios
        async function loadUsuarios() {
            try {
                const response = await fetch('/api/usuarios');
                const data = await response.json();
                
                if (data.success) {
                    renderUsuarios(data.usuarios);
                } else {
                    showToast('Erro ao carregar usu√°rios: ' + data.message, 'error');
                }
            } catch (error) {
                console.error('Erro ao carregar usu√°rios:', error);
                showToast('Erro ao carregar usu√°rios', 'error');
            }
        }
        
        // Renderizar tabela de usu√°rios
        function renderUsuarios(usuarios) {
            const tbody = document.getElementById('tbody-usuarios');
            
            // Filtrar usu√°rios baseado na tab ativa
            let usuariosFiltrados = usuarios;
            if (currentUsuarioFilter === 'ativos') {
                usuariosFiltrados = usuarios.filter(u => u.ativo);
            } else if (currentUsuarioFilter === 'inativos') {
                usuariosFiltrados = usuarios.filter(u => !u.ativo);
            }
            
            if (usuariosFiltrados.length === 0) {
                tbody.innerHTML = '<tr><td colspan="9" class="loading">Nenhum usu√°rio encontrado</td></tr>';
                return;
            }
            
            tbody.innerHTML = usuariosFiltrados.map(usuario => `
                <tr>
                    <td>${usuario.id}</td>
                    <td>${usuario.username}</td>
                    <td>${usuario.nome_completo || '-'}</td>
                    <td>${usuario.email || '-'}</td>
                    <td><span style="padding: 4px 8px; border-radius: 4px; font-weight: bold; ${usuario.tipo === 'admin' ? 'background: #e74c3c; color: white;' : 'background: #3498db; color: white;'}">${usuario.tipo === 'admin' ? '‚öôÔ∏è Admin' : 'üë§ Cliente'}</span></td>
                    <td>${usuario.cliente_nome || '-'}</td>
                    <td><span style="padding: 4px 8px; border-radius: 4px; font-weight: bold; ${usuario.ativo ? 'background: #27ae60; color: white;' : 'background: #e74c3c; color: white;'}">${usuario.ativo ? '‚úÖ Ativo' : '‚ùå Inativo'}</span></td>
                    <td>${usuario.ultima_sessao ? new Date(usuario.ultima_sessao).toLocaleString('pt-BR') : 'Nunca'}</td>
                    <td>
                        <button class="btn-action" onclick="editUsuario(${usuario.id})" title="Editar">‚úèÔ∏è</button>
                        <button class="btn-action" onclick="toggleUsuarioStatus(${usuario.id}, ${!usuario.ativo})" title="${usuario.ativo ? 'Inativar' : 'Ativar'}">${usuario.ativo ? '‚ùå' : '‚úÖ'}</button>
                        ${usuario.tipo !== 'admin' ? `<button class="btn-action" onclick="deleteUsuario(${usuario.id})" title="Excluir">üóëÔ∏è</button>` : ''}
                    </td>
                </tr>
            `).join('');
        }
        
        // Mudar tab de usu√°rios
        function showUsuariosTab(tipo) {
            currentUsuarioFilter = tipo;
            
            // Atualizar bot√µes
            ['ativos', 'inativos', 'todos'].forEach(t => {
                const btn = document.getElementById(`tab-usuarios-${t}`);
                if (t === tipo) {
                    btn.style.background = t === 'ativos' ? '#27ae60' : (t === 'inativos' ? '#e74c3c' : '#3498db');
                    btn.style.color = 'white';
                } else {
                    btn.style.background = '#bdc3c7';
                    btn.style.color = '#555';
                }
            });
            
            loadUsuarios();
        }
        
        // Abrir modal de usu√°rio
        function openModalUsuario(usuarioId = null) {
            const modal = document.createElement('div');
            modal.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: flex; justify-content: center; align-items: center; z-index: 10000;';
            
            modal.innerHTML = `
                <div style="background: white; padding: 30px; border-radius: 10px; width: 90%; max-width: 600px; max-height: 90vh; overflow-y: auto;">
                    <h2 style="margin: 0 0 20px 0;">${usuarioId ? 'Editar Usu√°rio' : '‚ûï Novo Usu√°rio'}</h2>
                    <form id="form-usuario">
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: 600;">Username:</label>
                            <input type="text" id="usuario-username" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                        </div>
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: 600;">Nome Completo:</label>
                            <input type="text" id="usuario-nome-completo" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                        </div>
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: 600;">E-mail:</label>
                            <input type="email" id="usuario-email" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                        </div>
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: 600;">Senha:${usuarioId ? ' (deixe em branco para manter)' : ''}</label>
                            <input type="password" id="usuario-senha" ${!usuarioId ? 'required' : ''} style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                        </div>
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: 600;">Tipo:</label>
                            <select id="usuario-tipo" onchange="toggleClienteSelect()" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                                <option value="cliente">Cliente</option>
                                <option value="admin">Administrador</option>
                            </select>
                        </div>
                        <div id="cliente-select-container" style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: 600;">Cliente Associado:</label>
                            <select id="usuario-cliente-id" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                                <option value="">-- Selecione um cliente --</option>
                            </select>
                        </div>
                        <div style="display: flex; gap: 10px; margin-top: 20px;">
                            <button type="submit" class="btn btn-primary" style="flex: 1;">üíæ Salvar</button>
                            <button type="button" class="btn" onclick="this.closest('div[style*=\\'position: fixed\\']').remove()" style="flex: 1; background: #95a5a6; color: white;">‚ùå Cancelar</button>
                        </div>
                    </form>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Carregar clientes para o select
            loadClientesSelect();
            
            // Se for edi√ß√£o, carregar dados do usu√°rio
            if (usuarioId) {
                loadUsuarioData(usuarioId);
            }
            
            // Submit do formul√°rio
            document.getElementById('form-usuario').addEventListener('submit', async (e) => {
                e.preventDefault();
                await saveUsuario(usuarioId, modal);
            });
        }
        
        // Carregar clientes para o select
        async function loadClientesSelect() {
            try {
                const response = await fetch('/api/clientes');
                const data = await response.json();
                
                if (data.success) {
                    const select = document.getElementById('usuario-cliente-id');
                    select.innerHTML = '<option value="">-- Selecione um cliente --</option>' +
                        data.clientes.filter(c => c.ativo).map(c => `<option value="${c.id}">${c.nome}</option>`).join('');
                }
            } catch (error) {
                console.error('Erro ao carregar clientes:', error);
            }
        }
        
        // Toggle visibilidade do select de cliente
        function toggleClienteSelect() {
            const tipo = document.getElementById('usuario-tipo').value;
            const container = document.getElementById('cliente-select-container');
            container.style.display = tipo === 'cliente' ? 'block' : 'none';
        }
        
        // Carregar dados do usu√°rio para edi√ß√£o
        async function loadUsuarioData(usuarioId) {
            try {
                const response = await fetch(`/api/usuarios/${usuarioId}`);
                const data = await response.json();
                
                if (data.success) {
                    const usuario = data.usuario;
                    document.getElementById('usuario-username').value = usuario.username;
                    document.getElementById('usuario-nome-completo').value = usuario.nome_completo || '';
                    document.getElementById('usuario-email').value = usuario.email || '';
                    document.getElementById('usuario-tipo').value = usuario.tipo;
                    if (usuario.cliente_id) {
                        document.getElementById('usuario-cliente-id').value = usuario.cliente_id;
                    }
                    toggleClienteSelect();
                }
            } catch (error) {
                console.error('Erro ao carregar usu√°rio:', error);
            }
        }
        
        // Salvar usu√°rio
        async function saveUsuario(usuarioId, modal) {
            const dados = {
                username: document.getElementById('usuario-username').value,
                nome_completo: document.getElementById('usuario-nome-completo').value,
                email: document.getElementById('usuario-email').value,
                tipo: document.getElementById('usuario-tipo').value,
                cliente_id: document.getElementById('usuario-cliente-id').value || null
            };
            
            const senha = document.getElementById('usuario-senha').value;
            if (senha) {
                dados.password = senha;
            }
            
            try {
                const url = usuarioId ? `/api/usuarios/${usuarioId}` : '/api/usuarios';
                const method = usuarioId ? 'PUT' : 'POST';
                
                const response = await fetch(url, {
                    method: method,
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(dados)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showToast(usuarioId ? 'Usu√°rio atualizado com sucesso!' : 'Usu√°rio criado com sucesso!', 'success');
                    modal.remove();
                    loadUsuarios();
                } else {
                    showToast('Erro: ' + result.message, 'error');
                }
            } catch (error) {
                console.error('Erro ao salvar usu√°rio:', error);
                showToast('Erro ao salvar usu√°rio', 'error');
            }
        }
        
        // Editar usu√°rio
        function editUsuario(usuarioId) {
            openModalUsuario(usuarioId);
        }
        
        // Alternar status do usu√°rio
        async function toggleUsuarioStatus(usuarioId, ativar) {
            const confirmado = await showConfirm(
                `Deseja realmente ${ativar ? 'ativar' : 'inativar'} este usu√°rio?`,
                {
                    title: `${ativar ? '‚úÖ' : '‚è∏Ô∏è'} ${ativar ? 'Ativar' : 'Inativar'} Usu√°rio`,
                    confirmText: ativar ? 'Ativar' : 'Inativar',
                    cancelText: 'Cancelar',
                    type: ativar ? 'success' : 'warning'
                }
            );
            if (!confirmado) return;
            
            try {
                const response = await fetch(`/api/usuarios/${usuarioId}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ ativo: ativar })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showToast(`Usu√°rio ${ativar ? 'ativado' : 'inativado'} com sucesso!`, 'success');
                    loadUsuarios();
                } else {
                    showToast('Erro: ' + result.message, 'error');
                }
            } catch (error) {
                console.error('Erro ao alterar status:', error);
                showToast('Erro ao alterar status do usu√°rio', 'error');
            }
        }
        
        // Excluir usu√°rio
        async function deleteUsuario(usuarioId) {
            const confirmado = await showConfirm(
                'Esta a√ß√£o n√£o pode ser desfeita! Todos os dados associados a este usu√°rio ser√£o permanentemente removidos.',
                {
                    title: 'üóëÔ∏è Excluir Usu√°rio',
                    confirmText: 'Excluir Permanentemente',
                    cancelText: 'Cancelar',
                    type: 'error'
                }
            );
            if (!confirmado) return;
            
            try {
                const response = await fetch(`/api/usuarios/${usuarioId}`, {
                    method: 'DELETE'
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showToast('Usu√°rio exclu√≠do com sucesso!', 'success');
                    loadUsuarios();
                } else {
                    showToast('Erro: ' + result.message, 'error');
                }
            } catch (error) {
                console.error('Erro ao excluir usu√°rio:', error);
                showToast('Erro ao excluir usu√°rio', 'error');
            }
        }
        
        // Atualizar lista de usu√°rios
        function refreshUsuarios() {
            loadUsuarios();
            showToast('Lista de usu√°rios atualizada!', 'success');
        }
        
        // ====================================
        // AUTENTICA√á√ÉO E USU√ÅRIO
        // ====================================
        
        // Verificar usu√°rio logado
        async function checkUserAuth() {
            console.log('üîê checkUserAuth: Iniciando verifica√ß√£o de autentica√ß√£o...');
            try {
                // Verificar autentica√ß√£o e carregar dados do usu√°rio
                const response = await fetch('/api/auth/verify');
                console.log('üì° Response status:', response.status);
                
                const data = await response.json();
                console.log('üì¶ Dados recebidos:', data);
                
                if (data.success && data.authenticated && data.usuario) {
                    console.log('‚úÖ Usu√°rio autenticado:', data.usuario.username);
                    
                    // Atualizar nome do usu√°rio na sidebar
                    const userElement = document.getElementById('userNameSidebar');
                    console.log('üë§ Elemento userNameSidebar:', userElement);
                    
                    if (userElement) {
                        const nome = data.usuario.nome_completo || data.usuario.username || 'Usu√°rio';
                        userElement.textContent = `üë§ ${nome}`;
                        console.log('‚úÖ Nome do usu√°rio atualizado para:', nome);
                    } else {
                        console.error('‚ùå Elemento userNameSidebar n√£o encontrado no DOM!');
                    }
                    
                    // Atualizar tipo de usu√°rio
                    const userTypeElement = document.getElementById('userTypeSidebar');
                    if (userTypeElement) {
                        const tipo = data.usuario.tipo === 'admin' ? 'üëë Administrador' : 'üë§ Usu√°rio';
                        userTypeElement.textContent = tipo;
                        console.log('‚úÖ Tipo de usu√°rio atualizado para:', tipo);
                    }
                    
                    // Mostrar bot√£o de admin se for administrador
                    const adminBtn = document.getElementById('adminBtn');
                    if (adminBtn && data.usuario.tipo === 'admin') {
                        adminBtn.style.display = 'block';
                        console.log('‚úÖ Bot√£o de admin exibido');
                    } else {
                        console.log('‚ÑπÔ∏è Bot√£o de admin oculto (usu√°rio n√£o √© admin)');
                    }
                    
                    // Carregar permiss√µes se necess√°rio (app.js)
                    if (typeof carregarPermissoesUsuario === 'function') {
                        console.log('üìã Carregando permiss√µes...');
                        await carregarPermissoesUsuario();
                    } else {
                        console.warn('‚ö†Ô∏è Fun√ß√£o carregarPermissoesUsuario n√£o encontrada');
                    }
                } else {
                    console.error('‚ùå Usu√°rio n√£o autenticado');
                    // N√£o autenticado, redirecionar para login
                    window.location.href = '/login';
                }
            } catch (error) {
                console.error('‚ùå Erro ao verificar autentica√ß√£o:', error);
                console.error('Stack trace:', error.stack);
                // Em caso de erro, tamb√©m redirecionar para login
                // window.location.href = '/login';
            }
        }
        
        // Carregar primeira p√°gina permitida  
        function carregarPaginaInicial() {
            console.log('üè† Carregando p√°gina inicial...');
            
            // Ocultar todas as se√ß√µes primeiro
            const sections = document.querySelectorAll('.content-card');
            sections.forEach(section => section.classList.add('hidden'));
            
            // Mostrar dashboard como padr√£o
            const dashboardSection = document.getElementById('dashboard-section');
            if (dashboardSection) {
                dashboardSection.classList.remove('hidden');
                console.log('‚úÖ Dashboard carregado');
            }
        }
        
        // Fazer logout
        async function logoutUser() {
            const confirmado = await showConfirm(
                'Voc√™ ser√° desconectado e redirecionado para a tela de login.',
                {
                    title: 'üö™ Sair do Sistema',
                    confirmText: 'Sair',
                    cancelText: 'Continuar Conectado',
                    type: 'info'
                }
            );
            if (!confirmado) return;
            
            try {
                await fetchWithCSRF('/api/auth/logout', {
                    method: 'POST'
                });
                window.location.href = '/login';
            } catch (error) {
                console.error('Erro ao fazer logout:', error);
                window.location.href = '/login';
            }
        }
        
        // ====================================
        // INICIALIZA√á√ÉO
        // ====================================
        
        // Inicializar dados ao carregar a p√°gina
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ DOMContentLoaded: P√°gina carregada, iniciando sistema...');
            
            // Verificar se toggleSubmenu est√° dispon√≠vel
            console.log('üîç Verificando fun√ß√£o toggleSubmenu:', typeof toggleSubmenu);
            
            // TESTE: Adicionar listener de click nos bot√µes de submenu para debug
            document.querySelectorAll('[id^="btn-"]').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    console.log('üî¥ CLICK EVENT CAPTURADO no bot√£o:', this.id);
                    console.log('   Target:', e.target);
                    console.log('   CurrentTarget:', e.currentTarget);
                });
            });
            
            // Verificar autentica√ß√£o primeiro
            console.log('üîê Chamando checkUserAuth...');
            checkUserAuth();
            
            // Definir ano e m√™s atuais nos filtros do dashboard
            const hoje = new Date();
            const anoAtual = hoje.getFullYear();
            const mesAtual = hoje.getMonth() + 1; // getMonth() retorna 0-11
            
            const inputAno = document.getElementById('filter-ano-dashboard');
            const selectMes = document.getElementById('filter-mes-dashboard');
            
            if (inputAno) {
                inputAno.value = anoAtual;
            }
            if (selectMes) {
                selectMes.value = mesAtual;
            }
            
            // Carregar contas banc√°rias no in√≠cio
            if (typeof loadContasBancarias === 'function') {
                console.log('Carregando contas banc√°rias...');
                loadContasBancarias();
            }
            
            // Carregar dashboard automaticamente
            if (typeof carregarDashboard === 'function') {
                setTimeout(() => {
                    carregarDashboard();
                }, 1000);
            }
        });

        // ====================================
        // NAVEGA√á√ÉO DE SE√á√ïES
        // ====================================
        
        function toggleSidebar() {
            const sidebar = document.querySelector('.sidebar');
            const mainContent = document.querySelector('.main-content');
            const toggleBtn = document.querySelector('.toggle-sidebar-btn');
            
            if (sidebar && mainContent) {
                sidebar.classList.toggle('hidden');
                mainContent.classList.toggle('expanded');
                
                // Mudar o √≠cone do bot√£o
                if (sidebar.classList.contains('hidden')) {
                    toggleBtn.textContent = '¬ª';
                    toggleBtn.title = 'Mostrar Menu';
                } else {
                    toggleBtn.textContent = '¬´';
                    toggleBtn.title = 'Ocultar Menu';
                }
            }
        }
        
        function showSection(sectionId) {
            console.log('%c üîç DEBUG - showSection() chamada ', 'background: #FF6B6B; color: white; font-weight: bold; padding: 4px;');
            console.log('  üìç sectionId:', sectionId);
            console.log('  üìç event.target:', event?.target);
            
            // NOTA: Verifica√ß√£o de permiss√µes temporariamente desabilitada para debug
            // A fun√ß√£o hasPermission n√£o est√° definida ainda
            // TODO: Implementar sistema de permiss√µes completo ou integrar com app.js
            
            // Ocultar todas as se√ß√µes
            const sections = document.querySelectorAll('.content-card');
            console.log('  üìä Total de se√ß√µes encontradas:', sections.length);
            sections.forEach(section => {
                section.classList.add('hidden');
            });
            
            // Mostrar a se√ß√£o selecionada
            const targetSection = document.getElementById(sectionId + '-section');
            console.log('  üéØ Se√ß√£o alvo:', sectionId + '-section', targetSection ? '‚úÖ Encontrada' : '‚ùå N√ÉO ENCONTRADA');
            if (targetSection) {
                targetSection.classList.remove('hidden');
            }
            
            // Atualizar bot√µes de navega√ß√£o
            const navButtons = document.querySelectorAll('.nav-button');
            navButtons.forEach(button => {
                button.classList.remove('active');
            });
            
            // Marcar o bot√£o clicado como ativo
            if (event?.target) {
                event.target.classList.add('active');
            }
            
            // Carregar dados da se√ß√£o se necess√°rio
            console.log('  üîÑ Verificando qual fun√ß√£o carregar para:', sectionId);
            
            if (sectionId === 'clientes') {
                console.log('  ‚û°Ô∏è loadClientesTable:', typeof loadClientesTable);
                if (typeof loadClientesTable === 'function') loadClientesTable();
            } else if (sectionId === 'fornecedores') {
                console.log('  ‚û°Ô∏è loadFornecedoresTable:', typeof loadFornecedoresTable);
                if (typeof loadFornecedoresTable === 'function') loadFornecedoresTable();
            } else if (sectionId === 'categorias') {
                console.log('  ‚û°Ô∏è loadCategoriasTable:', typeof loadCategoriasTable);
                if (typeof loadCategoriasTable === 'function') loadCategoriasTable();
            } else if (sectionId === 'contas-bancarias') {
                console.log('  ‚û°Ô∏è loadContasBancarias:', typeof loadContasBancarias);
                if (typeof loadContasBancarias === 'function') loadContasBancarias();
            } else if (sectionId === 'contas-receber') {
                console.log('  ‚û°Ô∏è loadContasReceber:', typeof loadContasReceber);
                if (typeof loadContasReceber === 'function') loadContasReceber();
            } else if (sectionId === 'contas-pagar') {
                console.log('  ‚û°Ô∏è loadContasPagar:', typeof loadContasPagar);
                if (typeof loadContasPagar === 'function') loadContasPagar();
            } else if (sectionId === 'extrato-bancario') {
                console.log('  ‚û°Ô∏è carregarContasBancariasExtrato:', typeof carregarContasBancariasExtrato);
                console.log('  ‚û°Ô∏è loadExtratoTransacoes:', typeof loadExtratoTransacoes);
                if (typeof carregarContasBancariasExtrato === 'function') carregarContasBancariasExtrato();
                if (typeof loadExtratoTransacoes === 'function') loadExtratoTransacoes();
            } else if (sectionId === 'fluxo-caixa') {
                console.log('  ‚û°Ô∏è carregarBancosFluxo:', typeof carregarBancosFluxo);
                console.log('  ‚û°Ô∏è carregarFluxoCaixa:', typeof carregarFluxoCaixa);
                if (typeof carregarBancosFluxo === 'function') carregarBancosFluxo();
                if (typeof carregarFluxoCaixa === 'function') carregarFluxoCaixa();
            } else if (sectionId === 'indicadores') {
                console.log('  ‚û°Ô∏è carregarIndicadores:', typeof carregarIndicadores);
                if (typeof carregarIndicadores === 'function') carregarIndicadores();
            } else if (sectionId === 'inadimplencia') {
                console.log('  ‚û°Ô∏è carregarInadimplencia:', typeof carregarInadimplencia);
                if (typeof carregarInadimplencia === 'function') carregarInadimplencia();
            } else if (sectionId === 'tipos-sessao') {
                console.log('  ‚û°Ô∏è loadTiposSessao:', typeof loadTiposSessao);
                if (typeof loadTiposSessao === 'function') loadTiposSessao();
            } else if (sectionId === 'contratos') {
                console.log('  ‚û°Ô∏è loadContratos:', typeof loadContratos);
                if (typeof loadContratos === 'function') loadContratos();
            } else if (sectionId === 'agenda-fotografia') {
                console.log('  ‚û°Ô∏è loadAgenda:', typeof loadAgenda);
                if (typeof loadAgenda === 'function') loadAgenda();
            } else if (sectionId === 'gestao-estoque') {
                console.log('  ‚û°Ô∏è loadProdutos:', typeof loadProdutos);
                if (typeof loadProdutos === 'function') loadProdutos();
            } else if (sectionId === 'kits-equipamentos') {
                console.log('  ‚û°Ô∏è loadKits:', typeof loadKits);
                if (typeof loadKits === 'function') loadKits();
            } else if (sectionId === 'tags-trabalho') {
                console.log('  ‚û°Ô∏è loadTags:', typeof loadTags);
                if (typeof loadTags === 'function') loadTags();
            } else if (sectionId === 'templates-equipe') {
                console.log('  ‚û°Ô∏è loadTemplates:', typeof loadTemplates);
                if (typeof loadTemplates === 'function') loadTemplates();
            } else if (sectionId === 'usuarios') {
                console.log('  ‚û°Ô∏è loadUsuarios:', typeof loadUsuarios);
                if (typeof loadUsuarios === 'function') loadUsuarios();
            } else if (sectionId === 'permissoes') {
                console.log('  ‚û°Ô∏è loadPermissoes:', typeof loadPermissoes);
                // N√£o carrega automaticamente, apenas quando selecionar usu√°rio
            } else if (sectionId === 'logs') {
                console.log('  ‚û°Ô∏è loadLogs:', typeof loadLogs);
                // if (typeof loadLogs === 'function') loadLogs();
            } else {
                console.log('  ‚ö†Ô∏è Nenhuma fun√ß√£o de carregamento definida para:', sectionId);
            }
            
            console.log('%c ‚úÖ showSection() finalizada ', 'background: #4CAF50; color: white; font-weight: bold; padding: 4px;');
        }
        
        function showCategoriaTab(tipo) {
            const btnReceita = document.getElementById('tab-receita');
            const btnDespesa = document.getElementById('tab-despesa');
            const containerReceita = document.getElementById('categorias-receita-container');
            const containerDespesa = document.getElementById('categorias-despesa-container');
            
            if (tipo === 'receita') {
                btnReceita.classList.add('active');
                btnReceita.style.background = '#27ae60';
                btnReceita.style.color = 'white';
                btnReceita.style.fontWeight = 'bold';
                
                btnDespesa.classList.remove('active');
                btnDespesa.style.background = '#bdc3c7';
                btnDespesa.style.color = '#555';
                btnDespesa.style.fontWeight = 'normal';
                
                // Mostrar receitas, esconder despesas
                if (containerReceita) containerReceita.classList.remove('hidden');
                if (containerDespesa) containerDespesa.classList.add('hidden');
            } else {
                btnDespesa.classList.add('active');
                btnDespesa.style.background = '#e74c3c';
                btnDespesa.style.color = 'white';
                btnDespesa.style.fontWeight = 'bold';
                
                btnReceita.classList.remove('active');
                btnReceita.style.background = '#bdc3c7';
                btnReceita.style.color = '#555';
                btnReceita.style.fontWeight = 'normal';
                
                // Mostrar despesas, esconder receitas
                if (containerDespesa) containerDespesa.classList.remove('hidden');
                if (containerReceita) containerReceita.classList.add('hidden');
            }
        }
        
        // ====================================
        // FUN√á√ÉO CARREGAR DASHBOARD
        // ====================================
        async function carregarDashboard() {
            try {
                console.log('üìä Carregando Dashboard...');
                
                // Pegar filtros
                const ano = document.getElementById('filter-ano-dashboard')?.value;
                const mes = document.getElementById('filter-mes-dashboard')?.value;
                
                // Construir URL com par√¢metros
                let url = '/api/relatorios/dashboard';
                const params = new URLSearchParams();
                if (ano) params.append('ano', ano);
                if (mes) params.append('mes', mes);
                if (params.toString()) url += '?' + params.toString();
                
                // Fazer requisi√ß√£o
                const response = await fetch(url);
                if (!response.ok) throw new Error('Erro ao carregar dashboard');
                
                const data = await response.json();
                
                // Atualizar conte√∫do de an√°lises se existir
                const analiseContent = document.getElementById('dashboard-analises-content');
                if (analiseContent && data.analises) {
                    analiseContent.innerHTML = data.analises;
                }
                
                // Renderizar gr√°fico se houver dados
                if (data.grafico_dados || data.meses) {
                    renderizarGraficoDashboard(data);
                }
                
                console.log('‚úÖ Dashboard carregado com sucesso');
            } catch (error) {
                console.error('‚ùå Erro ao carregar dashboard:', error);
                // N√£o mostrar mensagem de erro para n√£o poluir a UI
            }
        }
        
        // Fun√ß√£o para renderizar gr√°fico do dashboard
        function renderizarGraficoDashboard(data) {
            const canvas = document.getElementById('grafico-crescimento');
            if (!canvas) {
                console.warn('Canvas grafico-crescimento n√£o encontrado');
                return;
            }
            
            // Destruir gr√°fico anterior se existir
            if (window.dashboardChart) {
                window.dashboardChart.destroy();
            }
            
            const ctx = canvas.getContext('2d');
            
            // Preparar dados (assumindo estrutura do backend)
            const labels = data.meses || [];
            const receitas = data.receitas || [];
            const despesas = data.despesas || [];
            
            window.dashboardChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Receitas',
                            data: receitas,
                            borderColor: '#27ae60',
                            backgroundColor: 'rgba(39, 174, 96, 0.1)',
                            tension: 0.4,
                            fill: true
                        },
                        {
                            label: 'Despesas',
                            data: despesas,
                            borderColor: '#e74c3c',
                            backgroundColor: 'rgba(231, 76, 60, 0.1)',
                            tension: 0.4,
                            fill: true
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed.y !== null) {
                                        label += new Intl.NumberFormat('pt-BR', {
                                            style: 'currency',
                                            currency: 'BRL'
                                        }).format(context.parsed.y);
                                    }
                                    return label;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return new Intl.NumberFormat('pt-BR', {
                                        style: 'currency',
                                        currency: 'BRL',
                                        minimumFractionDigits: 0
                                    }).format(value);
                                }
                            }
                        }
                    }
                }
            });
        }

        // ==================== FUN√á√ïES DE EXTRATO BANC√ÅRIO ====================
        
        // Carregar contas banc√°rias nos selects
        async function carregarContasBancariasExtrato() {
            try {
                const response = await fetch('/api/contas');
                if (!response.ok) throw new Error('Erro ao carregar contas');
                
                const contas = await response.json();
                
                // Preencher select de upload
                const selectUpload = document.getElementById('conta-bancaria-extrato');
                selectUpload.innerHTML = '<option value="">Selecione a conta...</option>';
                
                // Preencher select de filtro
                const selectFiltro = document.getElementById('filtro-conta-extrato');
                selectFiltro.innerHTML = '<option value="">Todas as contas</option>';
                
                contas.forEach(conta => {
                    const optionUpload = document.createElement('option');
                    optionUpload.value = conta.nome;
                    optionUpload.textContent = `${conta.banco} - ${conta.nome}`;
                    selectUpload.appendChild(optionUpload);
                    
                    const optionFiltro = document.createElement('option');
                    optionFiltro.value = conta.nome;
                    optionFiltro.textContent = `${conta.banco} - ${conta.nome}`;
                    selectFiltro.appendChild(optionFiltro);
                });
            } catch (error) {
                console.error('Erro ao carregar contas banc√°rias:', error);
            }
        }

        // Upload de arquivo OFX
        async function uploadExtratoOFX(event) {
            const contaId = document.getElementById('conta-bancaria-extrato').value;
            const arquivoInput = document.getElementById('arquivo-ofx');
            const uploadButton = document.querySelector('button[onclick="uploadExtratoOFX(event)"]') || event?.target;
            
            if (!contaId) {
                alert('‚ùå Por favor, selecione uma conta banc√°ria!');
                return;
            }
            
            if (!arquivoInput.files || arquivoInput.files.length === 0) {
                alert('‚ùå Por favor, selecione um arquivo OFX!');
                return;
            }
            
            const arquivo = arquivoInput.files[0];
            
            // Validar extens√£o
            if (!arquivo.name.toLowerCase().endsWith('.ofx')) {
                alert('‚ùå Por favor, selecione um arquivo com extens√£o .ofx!');
                return;
            }
            
            const formData = new FormData();
            formData.append('file', arquivo);
            formData.append('conta_bancaria', contaId);
            
            try {
                if (uploadButton) {
                    uploadButton.disabled = true;
                    uploadButton.textContent = '‚è≥ Processando...';
                }
                
                const response = await fetch('/api/extratos/upload', {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    alert(`‚úÖ Arquivo importado com sucesso!\n\nüìä Transa√ß√µes importadas: ${result.transacoes_importadas || 0}`);
                    
                    // Limpar formul√°rio
                    document.getElementById('conta-bancaria-extrato').value = '';
                    arquivoInput.value = '';
                    
                    // Recarregar lista de transa√ß√µes
                    await loadExtratoTransacoes();
                } else {
                    alert(`‚ùå Erro ao importar arquivo:\n${result.error || 'Erro desconhecido'}`);
                }
            } catch (error) {
                console.error('Erro ao fazer upload:', error);
                alert('‚ùå Erro ao enviar arquivo. Verifique sua conex√£o e tente novamente.');
            } finally {
                if (uploadButton) {
                    uploadButton.disabled = false;
                    uploadButton.textContent = '‚¨ÜÔ∏è Enviar Arquivo';
                }
            }
        }

        // Carregar transa√ß√µes do extrato
        async function loadExtratoTransacoes() {
            const tbody = document.getElementById('tbody-extrato');
            tbody.innerHTML = '<tr><td colspan="8" class="loading">Carregando transa√ß√µes...</td></tr>';
            
            try {
                // Construir query parameters
                const params = new URLSearchParams();
                
                const contaId = document.getElementById('filtro-conta-extrato').value;
                if (contaId) params.append('conta', contaId);
                
                const dataInicio = document.getElementById('filtro-data-inicio-extrato').value;
                if (dataInicio) params.append('data_inicio', dataInicio);
                
                const dataFim = document.getElementById('filtro-data-fim-extrato').value;
                if (dataFim) params.append('data_fim', dataFim);
                
                const conciliado = document.getElementById('filtro-conciliado-extrato').value;
                if (conciliado) params.append('conciliado', conciliado);
                
                const response = await fetch(`/api/extratos?${params.toString()}`);
                
                if (!response.ok) {
                    throw new Error('Erro ao carregar transa√ß√µes');
                }
                
                const transacoes = await response.json();
                
                if (transacoes.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="8" style="text-align: center; padding: 40px; color: #999;">üì≠ Nenhuma transa√ß√£o encontrada. Importe um arquivo OFX para come√ßar.</td></tr>';
                    return;
                }
                
                tbody.innerHTML = '';
                
                transacoes.forEach(transacao => {
                    const tr = document.createElement('tr');
                    
                    // Data
                    const tdData = document.createElement('td');
                    tdData.textContent = new Date(transacao.data).toLocaleDateString('pt-BR');
                    tr.appendChild(tdData);
                    
                    // Descri√ß√£o
                    const tdDescricao = document.createElement('td');
                    tdDescricao.textContent = transacao.descricao || '-';
                    tdDescricao.style.maxWidth = '350px';
                    tdDescricao.style.overflow = 'hidden';
                    tdDescricao.style.textOverflow = 'ellipsis';
                    tdDescricao.style.whiteSpace = 'nowrap';
                    tr.appendChild(tdDescricao);
                    
                    // Valor
                    const tdValor = document.createElement('td');
                    const valor = parseFloat(transacao.valor);
                    tdValor.textContent = valor.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
                    tdValor.style.color = valor >= 0 ? '#27ae60' : '#e74c3c';
                    tdValor.style.fontWeight = 'bold';
                    tr.appendChild(tdValor);
                    
                    // Tipo
                    const tdTipo = document.createElement('td');
                    const tipoUpper = (transacao.tipo || '').toUpperCase();
                    tdTipo.textContent = tipoUpper === 'CREDITO' ? 'üìà Cr√©dito' : 'üìâ D√©bito';
                    tdTipo.style.fontSize = '12px';
                    tr.appendChild(tdTipo);
                    
                    // Saldo
                    const tdSaldo = document.createElement('td');
                    if (transacao.saldo !== null && transacao.saldo !== undefined) {
                        const saldo = parseFloat(transacao.saldo);
                        tdSaldo.textContent = saldo.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
                        tdSaldo.style.color = saldo >= 0 ? '#555' : '#e74c3c';
                    } else {
                        tdSaldo.textContent = '-';
                    }
                    tr.appendChild(tdSaldo);
                    
                    // Conta
                    const tdConta = document.createElement('td');
                    tdConta.textContent = transacao.conta_bancaria || '-';
                    tdConta.style.fontSize = '12px';
                    tr.appendChild(tdConta);
                    
                    // Status
                    const tdStatus = document.createElement('td');
                    if (transacao.conciliado) {
                        tdStatus.innerHTML = '<span style="background: #27ae60; color: white; padding: 4px 8px; border-radius: 4px; font-size: 11px;">‚úì Conciliado</span>';
                    } else {
                        tdStatus.innerHTML = '<span style="background: #f39c12; color: white; padding: 4px 8px; border-radius: 4px; font-size: 11px;">‚è≥ Pendente</span>';
                    }
                    tr.appendChild(tdStatus);
                    
                    // A√ß√µes
                    const tdAcoes = document.createElement('td');
                    if (!transacao.conciliado) {
                        const btnConciliar = document.createElement('button');
                        btnConciliar.textContent = 'üîó Conciliar';
                        btnConciliar.className = 'btn btn-sm btn-primary';
                        btnConciliar.style.fontSize = '11px';
                        btnConciliar.style.padding = '4px 8px';
                        btnConciliar.onclick = () => conciliarTransacao(transacao.id);
                        tdAcoes.appendChild(btnConciliar);
                    } else {
                        tdAcoes.textContent = '-';
                    }
                    tr.appendChild(tdAcoes);
                    
                    tbody.appendChild(tr);
                });
                
            } catch (error) {
                console.error('Erro ao carregar transa√ß√µes:', error);
                tbody.innerHTML = '<tr><td colspan="8" style="text-align: center; padding: 20px; color: #e74c3c;">‚ùå Erro ao carregar transa√ß√µes</td></tr>';
            }
        }

        // Limpar filtros
        function limparFiltrosExtrato() {
            document.getElementById('filtro-conta-extrato').value = '';
            document.getElementById('filtro-data-inicio-extrato').value = '';
            document.getElementById('filtro-data-fim-extrato').value = '';
            document.getElementById('filtro-conciliado-extrato').value = '';
            loadExtratoTransacoes();
        }

        // Deletar extratos filtrados
        async function deletarExtratoFiltrado() {
            const contaId = document.getElementById('filtro-conta-extrato').value;
            const dataInicio = document.getElementById('filtro-data-inicio-extrato').value;
            const dataFim = document.getElementById('filtro-data-fim-extrato').value;
            
            // Verificar se h√° filtros aplicados
            if (!contaId && !dataInicio && !dataFim) {
                alert('‚ö†Ô∏è Por favor, aplique pelo menos um filtro (conta ou per√≠odo) antes de deletar!\n\nIsso evita deletar todos os extratos acidentalmente.');
                return;
            }
            
            // Confirma√ß√£o
            let mensagem = '‚ö†Ô∏è ATEN√á√ÉO: Esta a√ß√£o n√£o pode ser desfeita!\n\nVoc√™ est√° prestes a deletar os extratos com os seguintes filtros:\n';
            if (contaId) {
                const contaSelect = document.getElementById('filtro-conta-extrato');
                const contaNome = contaSelect.options[contaSelect.selectedIndex].text;
                mensagem += `\nüìå Conta: ${contaNome}`;
            }
            if (dataInicio) mensagem += `\nüìÖ Data in√≠cio: ${new Date(dataInicio).toLocaleDateString('pt-BR')}`;
            if (dataFim) mensagem += `\nüìÖ Data fim: ${new Date(dataFim).toLocaleDateString('pt-BR')}`;
            mensagem += '\n\nDeseja continuar?';
            
            if (!confirm(mensagem)) {
                return;
            }
            
            try {
                // Construir query parameters
                const params = new URLSearchParams();
                if (contaId) params.append('conta', contaId);
                if (dataInicio) params.append('data_inicio', dataInicio);
                if (dataFim) params.append('data_fim', dataFim);
                
                const response = await fetch(`/api/extratos/deletar-filtrado?${params.toString()}`, {
                    method: 'DELETE'
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    alert(`‚úÖ Extratos deletados com sucesso!\n\nüìä Total deletado: ${result.deletados || 0} transa√ß√£o(√µes)`);
                    
                    // Limpar filtros e recarregar
                    limparFiltrosExtrato();
                } else {
                    alert(`‚ùå Erro ao deletar extratos:\n${result.error || 'Erro desconhecido'}`);
                }
            } catch (error) {
                console.error('Erro ao deletar extratos:', error);
                alert('‚ùå Erro ao deletar extratos. Verifique sua conex√£o e tente novamente.');
            }
        }

        // Conciliar transa√ß√£o (placeholder - pode ser expandido)
        async function conciliarTransacao(transacaoId) {
            alert('üîó Funcionalidade de concilia√ß√£o ser√° implementada em breve!\n\nEsta transa√ß√£o ser√° vinculada a um lan√ßamento do sistema.');
        }

        // toggleSubmenu() j√° definida no HEAD - n√£o redefinir aqui

        // ====================================
        // SISTEMA DE NOTIFICA√á√ïES TOAST
        // ====================================
        
        function showToast(message, type = 'success') {
            // Criar container se n√£o existir
            let container = document.querySelector('.toast-container');
            if (!container) {
                container = document.createElement('div');
                container.className = 'toast-container';
                document.body.appendChild(container);
            }
            
            // Criar toast
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            
            // Definir √≠cone baseado no tipo
            let icon = '';
            switch(type) {
                case 'success':
                    icon = '‚úì';
                    break;
                case 'error':
                    icon = '‚úï';
                    break;
                case 'warning':
                    icon = '‚ö†';
                    break;
                case 'info':
                    icon = '‚Ñπ';
                    break;
                default:
                    icon = '‚úì';
            }
            
            toast.innerHTML = `
                <span class="toast-icon">${icon}</span>
                <span class="toast-message">${message}</span>
            `;
            
            container.appendChild(toast);
            
            // Animar entrada
            setTimeout(() => {
                toast.style.opacity = '1';
                toast.style.transform = 'translateX(0)';
            }, 10);
            
            // Remover ap√≥s 3 segundos
            setTimeout(() => {
                toast.classList.add('hiding');
                toast.style.opacity = '0';
                toast.style.transform = 'translateX(100%)';
                
                setTimeout(() => {
                    // Verificar se toast ainda √© filho do container
                    if (toast.parentNode === container) {
                        container.removeChild(toast);
                    }
                    
                    // Remover container se vazio e ainda estiver no body
                    if (container.children.length === 0 && container.parentNode === document.body) {
                        document.body.removeChild(container);
                    }
                }, 300);
            }, 3000);
        }

        // ====================================
        // SISTEMA DE CONFIRMA√á√ÉO INTELIGENTE
        // ====================================
        
        function showConfirm(message, options = {}) {
            return new Promise((resolve) => {
                const {
                    title = '‚ö†Ô∏è Confirma√ß√£o',
                    confirmText = 'Confirmar',
                    cancelText = 'Cancelar',
                    type = 'warning' // success, error, warning, info
                } = options;
                
                // Criar overlay
                const overlay = document.createElement('div');
                overlay.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0, 0, 0, 0.5);
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    z-index: 10000;
                    opacity: 0;
                    transition: opacity 0.3s ease;
                `;
                
                // Definir cores baseado no tipo
                let colors = {
                    success: '#27ae60',
                    error: '#e74c3c',
                    warning: '#f39c12',
                    info: '#3498db'
                };
                const color = colors[type] || colors.warning;
                
                // Criar modal de confirma√ß√£o
                const modal = document.createElement('div');
                modal.style.cssText = `
                    background: white;
                    padding: 30px;
                    border-radius: 15px;
                    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
                    max-width: 450px;
                    width: 90%;
                    transform: scale(0.7);
                    transition: transform 0.3s ease;
                `;
                
                modal.innerHTML = `
                    <div style="text-align: center;">
                        <div style="font-size: 50px; margin-bottom: 20px;">${title.split(' ')[0]}</div>
                        <h2 style="margin: 0 0 10px 0; color: #2c3e50;">${title.replace(/^[^\s]+\s/, '')}</h2>
                        <p style="color: #7f8c8d; font-size: 16px; margin-bottom: 30px;">${message}</p>
                        <div style="display: flex; gap: 10px; justify-content: center;">
                            <button id="confirm-cancel" style="
                                flex: 1;
                                padding: 12px 24px;
                                border: 2px solid #bdc3c7;
                                background: white;
                                color: #7f8c8d;
                                border-radius: 8px;
                                cursor: pointer;
                                font-size: 15px;
                                font-weight: 600;
                                transition: all 0.3s ease;
                            ">${cancelText}</button>
                            <button id="confirm-ok" style="
                                flex: 1;
                                padding: 12px 24px;
                                border: none;
                                background: ${color};
                                color: white;
                                border-radius: 8px;
                                cursor: pointer;
                                font-size: 15px;
                                font-weight: 600;
                                transition: all 0.3s ease;
                            ">${confirmText}</button>
                        </div>
                    </div>
                `;
                
                overlay.appendChild(modal);
                document.body.appendChild(overlay);
                
                // Animar entrada
                setTimeout(() => {
                    overlay.style.opacity = '1';
                    modal.style.transform = 'scale(1)';
                }, 10);
                
                // Adicionar hover nos bot√µes
                const cancelBtn = modal.querySelector('#confirm-cancel');
                const okBtn = modal.querySelector('#confirm-ok');
                
                cancelBtn.addEventListener('mouseenter', () => {
                    cancelBtn.style.background = '#ecf0f1';
                    cancelBtn.style.transform = 'translateY(-2px)';
                });
                cancelBtn.addEventListener('mouseleave', () => {
                    cancelBtn.style.background = 'white';
                    cancelBtn.style.transform = 'translateY(0)';
                });
                
                okBtn.addEventListener('mouseenter', () => {
                    okBtn.style.transform = 'translateY(-2px)';
                    okBtn.style.boxShadow = '0 4px 12px rgba(0,0,0,0.2)';
                });
                okBtn.addEventListener('mouseleave', () => {
                    okBtn.style.transform = 'translateY(0)';
                    okBtn.style.boxShadow = 'none';
                });
                
                // Fun√ß√£o para fechar o modal
                const closeModal = (result) => {
                    overlay.style.opacity = '0';
                    modal.style.transform = 'scale(0.7)';
                    setTimeout(() => {
                        if (overlay.parentNode) {
                            document.body.removeChild(overlay);
                        }
                        resolve(result);
                    }, 300);
                };
                
                // Event listeners
                cancelBtn.addEventListener('click', () => closeModal(false));
                okBtn.addEventListener('click', () => closeModal(true));
                overlay.addEventListener('click', (e) => {
                    if (e.target === overlay) closeModal(false);
                });
                
                // ESC para cancelar
                const escHandler = (e) => {
                    if (e.key === 'Escape') {
                        closeModal(false);
                        document.removeEventListener('keydown', escHandler);
                    }
                };
                document.addEventListener('keydown', escHandler);
            });
        }

        // ====================================
        // FORMATA√á√ÉO AUTOM√ÅTICA DE MOEDA (R$)
        // ====================================
        
        function formatarMoedaBR(input) {
            let valor = input.value.replace(/\D/g, ''); // Remove tudo que n√£o √© d√≠gito
            
            if (valor === '' || valor === '0') {
                input.value = '';
                input.dataset.valorReal = '0';
                return;
            }
            
            // Converte para n√∫mero com 2 casas decimais
            valor = (parseInt(valor) / 100).toFixed(2);
            
            // Salva o valor real (sem formata√ß√£o) no dataset
            input.dataset.valorReal = valor;
            
            // Formata com ponto como separador de milhar e v√≠rgula como decimal
            let partes = valor.split('.');
            partes[0] = partes[0].replace(/\B(?=(\d{3})+(?!\d))/g, '.');
            input.value = partes.join(',');
        }
        
        function aplicarFormatacaoMoeda(input) {
            // Quando o campo perde foco, aplica a formata√ß√£o
            input.addEventListener('blur', function() {
                // Limpa e converte para n√∫mero
                let valor = this.value.replace(/\./g, '').replace(',', '.');
                let numero = parseFloat(valor);
                
                if (isNaN(numero) || numero === 0) {
                    this.value = '';
                    this.dataset.valorReal = '0';
                    return;
                }
                
                // Salva o valor real
                this.dataset.valorReal = numero.toFixed(2);
                
                // Formata para exibi√ß√£o: 1.234,56
                this.value = numero.toLocaleString('pt-BR', { 
                    minimumFractionDigits: 2, 
                    maximumFractionDigits: 2 
                });
            });
            
            // Formata√ß√£o em tempo real enquanto digita
            input.addEventListener('input', function(e) {
                // Permite n√∫meros, v√≠rgula e ponto
                let valor = this.value;
                // Remove caracteres n√£o permitidos (mant√©m apenas n√∫meros, v√≠rgula e ponto)
                valor = valor.replace(/[^\d.,]/g, '');
                // Permite apenas uma v√≠rgula ou um ponto
                let temVirgula = valor.indexOf(',');
                let temPonto = valor.indexOf('.');
                
                if (temVirgula !== -1 && temPonto !== -1) {
                    // Se tem ambos, remove o √∫ltimo digitado
                    if (temVirgula > temPonto) {
                        valor = valor.replace(/\./g, '');
                    } else {
                        valor = valor.replace(/,/g, '');
                    }
                }
                
                this.value = valor;
            });
            
            // Trata colagem
            input.addEventListener('paste', function(e) {
                e.preventDefault();
                let texto = (e.clipboardData || window.clipboardData).getData('text');
                // Limpa e normaliza
                texto = texto.replace(/[^\d.,]/g, '');
                this.value = texto;
                // Dispara evento input para validar
                this.dispatchEvent(new Event('input'));
            });
        }
        
        // Fun√ß√£o para obter o valor real (sem formata√ß√£o) de um campo
        function obterValorReal(input) {
            if (input.dataset.valorReal) {
                return parseFloat(input.dataset.valorReal);
            }
            // Fallback: tenta converter o valor do campo
            // Aceita tanto formato brasileiro (1.234,56) quanto americano (1234.56)
            let valor = input.value;
            
            // Se tem ponto e v√≠rgula, assume formato brasileiro
            if (valor.includes('.') && valor.includes(',')) {
                valor = valor.replace(/\./g, '').replace(',', '.');
            }
            // Se tem apenas v√≠rgula, assume decimal brasileiro
            else if (valor.includes(',') && !valor.includes('.')) {
                valor = valor.replace(',', '.');
            }
            // Se tem apenas ponto, pode ser milhar ou decimal
            else if (valor.includes('.') && !valor.includes(',')) {
                // Se tem mais de um ponto, √© separador de milhar
                if ((valor.match(/\./g) || []).length > 1) {
                    valor = valor.replace(/\./g, '');
                }
                // Se √© apenas um ponto, pode ser decimal (aceita ambos formatos)
            }
            
            return parseFloat(valor) || 0;
        }
        
        // ====================================
        // CONVERS√ÉO AUTOM√ÅTICA PARA MAI√öSCULAS
        // ====================================
        
        function aplicarMaiusculas(input) {
            // Ignora campos de tipo espec√≠fico que n√£o devem ser mai√∫sculos
            const tiposIgnorados = ['date', 'month', 'email', 'password', 'number'];
            
            if (tiposIgnorados.includes(input.type)) {
                return;
            }
            
            // Ignora campos de valor/saldo/juros que j√° t√™m formata√ß√£o de moeda
            if (input.id.includes('valor') || input.id.includes('saldo') || input.id.includes('juros')) {
                return;
            }
            
            input.addEventListener('input', function() {
                const inicio = this.selectionStart;
                const fim = this.selectionEnd;
                this.value = this.value.toUpperCase();
                this.setSelectionRange(inicio, fim);
            });
        }
        
        // Aplica formata√ß√£o autom√°tica a todos os campos quando a p√°gina carrega
        document.addEventListener('DOMContentLoaded', function() {
            // Observer para detectar novos campos adicionados dinamicamente (modals)
            const observer = new MutationObserver(function(mutations) {
                mutations.forEach(function(mutation) {
                    mutation.addedNodes.forEach(function(node) {
                        if (node.nodeType === 1) { // Element node
                            // Busca campos de valor no novo conte√∫do
                            const camposValor = node.querySelectorAll 
                                ? node.querySelectorAll('input[id*="valor"], input[id*="saldo"], input[id*="juros"]')
                                : [];
                            
                            camposValor.forEach(function(campo) {
                                if (campo.type === 'number' || campo.id.includes('valor') || campo.id.includes('saldo') || campo.id.includes('juros')) {
                                    // Converte para tipo text para permitir formata√ß√£o
                                    campo.type = 'text';
                                    campo.inputMode = 'numeric';
                                    campo.placeholder = '0,00';
                                    aplicarFormatacaoMoeda(campo);
                                }
                            });
                            
                            // Busca todos os campos de texto e textarea para aplicar mai√∫sculas
                            const camposTexto = node.querySelectorAll 
                                ? node.querySelectorAll('input[type="text"], textarea')
                                : [];
                            
                            camposTexto.forEach(function(campo) {
                                aplicarMaiusculas(campo);
                            });
                        }
                    });
                });
            });
            
            // Inicia observa√ß√£o no body inteiro
            observer.observe(document.body, {
                childList: true,
                subtree: true
            });
            
            // Aplica mai√∫sculas em campos j√° existentes na p√°gina
            document.querySelectorAll('input[type="text"], textarea').forEach(function(campo) {
                aplicarMaiusculas(campo);
            });
        });
    </script>
    
    <!-- Modal de Subcategorias -->
    <div id="modal-subcategorias" class="modal-subcategorias-overlay">
        <div class="modal-subcategorias-content">
            <div class="modal-subcategorias-header">
                <h3 id="modal-subcategorias-titulo">üìã Subcategorias</h3>
                <button class="modal-subcategorias-close" onclick="fecharModalSubcategorias()">√ó</button>
            </div>
            <div class="modal-subcategorias-body">
                <ul id="modal-subcategorias-lista" class="subcategorias-list"></ul>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    <script src="/static/app.js?v={{ build_timestamp }}"></script>
    <script src="/static/pdf_functions.js?v={{ build_timestamp }}"></script>
    <script src="/static/excel_functions.js?v={{ build_timestamp }}"></script>
    <script src="/static/analise_functions.js?v={{ build_timestamp }}"></script>
    <script src="/static/modals.js?v={{ build_timestamp }}"></script>
    
    <!-- Service Worker para controle de cache -->
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/static/service-worker.js?v={{ build_timestamp }}')
                .then(reg => console.log('‚úÖ Service Worker registrado'))
                .catch(err => console.warn('‚ö†Ô∏è Service Worker erro:', err));
        }
    </script>
    
    <script>
        // Garantir que contas sejam carregadas ao abrir a se√ß√£o
        setTimeout(() => {
            if (typeof loadContasBancarias === 'function') {
                loadContasBancarias();
            }
        }, 500);
    </script>
</body>
</html>
